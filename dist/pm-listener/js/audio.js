var AudioAnalyzer=function(){this.sourceNode=null,this.analyzer=null,this.audioContext=null,this.buflen=1024,this.buf=new Float32Array(this.buflen),this.rafID=null,this.setupMedia=function(){this.audioContext=new AudioContext;var t={audio:{latency:.002},video:!1},e=this;navigator.mediaDevices.getUserMedia(t).then(function(t){pm_log("Using the stream"),e.gotStream(t)}).catch(function(t){pm_log("Error: "+t,10)})},this.getSampleRate=function(){return this.audioContext.sampleRate},this.gotStream=function(t){console.log("Got stream"),mediaStreamSource=this.audioContext.createMediaStreamSource(t),this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=2048,mediaStreamSource.connect(this.analyzer)},this.updatePitch=function(t){if(null!=this.analyzer){new Array;return this.analyzer.getFloatTimeDomainData(this.buf),this.autoCorrelate(this.buf,this.audioContext.sampleRate)}},this.autoCorrelate=function(t,e){for(var a=t.length,i=Math.floor(a/2),r=-1,n=0,o=0,u=!1,s=new Array(i),l=0;l<a;l++){var h=t[l];o+=h*h}if((o=Math.sqrt(o/a))<.01)return-1;for(var f=1,c=MIN_SAMPLES;c<i;c++){for(var d=0,l=0;l<i;l++)d+=Math.abs(t[l]-t[l+c]);if(d=1-d/i,s[c]=d,d>GOOD_ENOUGH_CORRELATION&&d>f)u=!0,d>n&&(n=d,r=c);else if(u)return e/(r+8*((s[r+1]-s[r-1])/s[r]));f=d}return n>.01?e/r:-1}},MIN_SAMPLES=0,GOOD_ENOUGH_CORRELATION=.9,audioAnalyzer=new AudioAnalyzer;