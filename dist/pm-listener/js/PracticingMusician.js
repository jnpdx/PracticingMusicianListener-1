if("undefined"==typeof kotlin)throw new Error("Error loading module 'PracticingMusician'. Its dependency 'kotlin' was not found. Please, check whether 'kotlin' is loaded prior to 'PracticingMusician'.");var PracticingMusician=function(t,e){"use strict";function n(){this.scoreUtil=new EasyScoreUtil,this.generatedExercise=this.generatedExercise,this.parameters=this.parameters,this.audioManager=new u,this.exerciseManager=new f(this.audioManager)}function i(){}function o(){}function r(){}function a(){}function s(t,e){this.noteNumber=t,this.duration=e}function l(t,e){this.x=t,this.y=e}function c(){Ct=this,this.metronomeAudioOn=!0,this.transposition=0,this.tempo=-1,this.pitch=440}function p(){return null===Ct&&new c,Ct}function u(){this.loadedAudio=e.kotlin.collections.LinkedHashMap_init_q3lmfv$(),this.timeoutKeys=e.kotlin.collections.ArrayList_init_ww73n8$()}function h(t,n){return function(){return pm_log("(( Playing..."+e.toString(t),6),null!=n&&(n.currentTime=0),null!=n?n.play():null}}function m(t){return!0}function d(){this.notes=e.kotlin.collections.ArrayList_init_ww73n8$(),this.notationItems=e.kotlin.collections.ArrayList_init_ww73n8$(),this.tempo=120}function f(t){this.currentExercise=null,this.timeKeeper=new H,this.metronome=new R,this.pitchTracker=new J,this.bufferManager=new A,this.comparisonEngine=new T,this.audioManager=t,pm_log("Init"),this.lastAnalysisTimestamp=mt.MIN_VALUE}function g(t){return function(n){var i;t.audioManager.cancelAllAudio(),t.metronome.cancelAllUIUpdates();var o=t.pitchTracker.samples.size/44100;pm_log("Total samples recorded: "+e.toString(t.pitchTracker.samples.size)+" length: "+e.toString(o)),t.bufferManager.tempo=t.metronome.tempo;var r=t.bufferManager.convertSamplesBufferToNotes_mtnj1d$(t.pitchTracker.samples);pm_log("Notes: ");var a;for(a=r.iterator();a.hasNext();){var s=a.next();pm_log("Note: "+e.toString(s.note.noteNumber)+" for "+e.toString(s.note.duration)+" at "+e.toString(s.positionInBeats))}if(null!=(i=t.currentExercise)){var l=t;pm_log("Comparing...");var c=l.comparisonEngine.compareNoteArrays_11i8u3$(i.notes,r);listenerApp.clearFeedbackItems();var p;for(p=c.feedbackItems.iterator();p.hasNext();){var u=p.next(),h=u.beat;listenerApp.addFeedbackItem_k93uln$(h,u.feedbackItemType)}window.alert("Your results are: "+e.toString(c.correct)+"/"+e.toString(c.attempted)),z().buildAndSendRequest_fhpv3e$(c)}}}function v(){It=this,this.sampleRate=44100,this.minDurationInBeats=.25}function _(){return null===It&&new v,It}function y(){Et=this,this.allowableFreqencyMargin=10,this.allowableRhythmMargin=.25}function $(){return null===Et&&new y,Et}function w(t,e){this.name=t,this.value=e}function b(t,e){this.beat=t,this.feedbackItemType=e}function S(t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.c=t,this.a=n,this.correct=this.c,this.attempted=this.a,this.feedbackItems=e.kotlin.collections.ArrayList_init_ww73n8$(),this.finalResults=e.kotlin.collections.ArrayList_init_ww73n8$()}function k(t,e,n,i,o,r,a,s){void 0===t&&(t=-1),void 0===e&&(e=-1),this.userID=t,this.exerciseID=e,this.correct=n,this.attempted=i,this.exerciseAveragePitch=o,this.exerciseAverageRhythm=r,this.exerciseAverageDuration=a,this.notePerformances=s}function x(t,e,n,i,o,r){this.idealBeat=t,this.actualBeat=e,this.idealPitch=n,this.actualPitch=i,this.idealDuration=o,this.actualDuration=r}function N(t,e){this.note=t,this.positionInBeats=e}function A(){this.tempo=0,this.sampleRate=44100,this.minDurationInBeats=.25}function T(){this.allowableCentsMargin=40,this.allowableRhythmMargin=.25,this.allowableLengthMargin=.25}function C(t){this.frequency=t,this.markers=null}function I(t,e){kt.call(this),this.name$=t,this.ordinal$=e}function E(){E=function(){},Pt=new I("NoteChange",0),Lt=new I("BeatChange",1)}function P(){return E(),Pt}function L(){return E(),Lt}function O(){Ot=this,this.mapTest=Nt([xt("test",1),xt("test2",4)])}function z(){return null===Ot&&new O,Ot}function B(){this.scorePositionInitialX=60,this.scorePositionInitialY=20,this.scorePositionX=0,this.scorePositionY=0,this.positionInLine=0,this.scorePositionCurrentLine=0,this.measureCounter=0,this.exercise=null,this.generatedExercise=this.generatedExercise,this.vf=null,this.registry=null,this.score=null,this.voice=null,this.beam=null,this.contentScaleFactor=1,this.useScaling=!0,this.assumedCanvasWidth=1024,this.barWidth=200,this.barHeight=160,this.firstBarAddition=40,this.barsPerLine=4,this.noteIDNumber=0,this.systems=e.kotlin.collections.ArrayList_init_ww73n8$()}function q(){}function F(){}function j(t,e,n){D(),void 0===n&&(n="none"),this.noteNumber=t,this.duration=e,this.textValue=n,this.avgFreq=null}function M(){zt=this}function D(){return null===zt&&new M,zt}function R(){this.audioKey="metronomeSound",this.audioManager=this.audioManager,this.state_t08vao$_0=G(),this.timeSignature=4,this.prerollBeats=this.timeSignature,this.tempo=120,this.currentBeat=0,this.beatTimes=e.kotlin.collections.ArrayList_init_ww73n8$(),this.lastBeatOccuredAt=-1,this.timeoutKeys=e.kotlin.collections.ArrayList_init_ww73n8$()}function K(t){return!0}function U(t,e){this.freq=t,this.lengthInSamples=e}function J(){this.sampleRate=44100,this.lengthOfPrerollToIgnore=0,this.latencyTime=180,this.samples=e.kotlin.collections.ArrayList_init_ww73n8$(),this.samplesRecorded=0,this.state_j0gsl6$_0=G()}function H(){this.finishedActions=e.kotlin.collections.ArrayList_init_ww73n8$(),this.state_k2u27h$_0=G(),this.steppables=e.kotlin.collections.ArrayList_init_ww73n8$(),this.analyzers=e.kotlin.collections.ArrayList_init_ww73n8$(),this.timeOffSet=-1,this.runForTime=4100}function V(t,e){kt.call(this),this.name$=t,this.ordinal$=e}function W(){W=function(){},Ft=new V("Stopped",0),jt=new V("Running",1),Mt=new V("Completed",2)}function G(){return W(),Ft}function X(){return W(),jt}function Y(){return W(),Mt}function Q(t){return function(e){t.step_14dthe$(e)}}function Z(){}function tt(){}function et(){Dt=this}function nt(){this.tracker=new J}function it(){Rt=this,this.notes=lt([new j(69,.5),new j(81,1),new j(69,1),new j(81,1)]),this.tempo=120,this.secondsPerBeat=60/this.tempo,this.sampleRate=44100,this.bufferLengthInSamples=1024}function ot(){Kt=this}function rt(){return null===Kt&&new ot,Kt}function at(t){}var st=e.kotlin.collections.listOf_mh5how$,lt=e.kotlin.collections.listOf_i5x0yv$,ct=e.kotlin.ranges.until_dqglrj$,pt=e.kotlin.collections.toList_us0mfu$,ut=e.kotlin.collections.reversed_7wnvza$,ht=e.kotlin.collections.removeAll_qafx1e$,mt=e.kotlin.js.internal.DoubleCompanionObject,dt=e.kotlin.collections.toMutableList_4c7yge$,ft=e.kotlin.collections.zip_45mdf7$,gt=e.kotlin.io.println_s8jyv4$,vt=e.kotlin.collections.withIndex_7wnvza$,_t=e.kotlin.collections.get_indices_gzk92b$,yt=e.kotlin.collections.plus_qloxvw$,$t=e.kotlin.collections.average_l63kqw$,wt=e.kotlin.js.internal.IntCompanionObject,bt=e.kotlin.Pair,St=e.kotlin.collections.last_2p1efm$,kt=e.kotlin.Enum,xt=e.kotlin.to_ujzrz7$,Nt=e.kotlin.collections.mapOf_qfcya0$,At=e.kotlin.ranges.IntRange,Tt=e.kotlin.ranges.step_xsgg7u$;I.prototype=Object.create(kt.prototype),I.prototype.constructor=I,V.prototype=Object.create(kt.prototype),V.prototype.constructor=V,n.prototype.runApp=function(t){this.parameters=t,D().createAllNotes(),audioAnalyzer.setupMedia(),this.generatedExercise=generateExerciseForKotlin(),this.generatedExercise=p().applyToExercise_k94nyn$(this.generatedExercise),this.exerciseManager.loadExercise(),this.makeDomElements()},n.prototype.makeDomElements=function(){var t,n,i,o,r,a;pm_log("Making window w/ container: "+this.parameters.notationContainerName,10);var s=e.isType(t=document.getElementById(this.parameters.notationContainerName),HTMLElement)?t:e.throwCCE();s.className=s.className+"notationBodyContainer";var l=e.isType(n=document.createElement("canvas"),HTMLElement)?n:e.throwCCE();l.style.position="absolute",l.id="indicatorCanvas",null!=(i=document.getElementById(this.parameters.notationContainerName))&&i.appendChild(l),pm_log("Made indicator canvas on notation body: ",10),pm_log(e.isType(o=document.getElementById(this.parameters.notationContainerName),HTMLElement)?o:e.throwCCE());var c=e.isType(r=document.createElement("canvas"),HTMLElement)?r:e.throwCCE();c.style.position="absolute",c.id="feedbackCanvas",null!=(a=document.getElementById(this.parameters.notationContainerName))&&a.appendChild(c),this.makeScore_61zpoe$(this.parameters.notationContainerName);var p;for(p=lt([new b(1,st(new w("test","val"))),new b(2,st(new w("test","val"))),new b(3,st(new w("test","val")))]).iterator();p.hasNext();){var u=p.next(),h=u.beat;listenerApp.addFeedbackItem_k93uln$(h,u.feedbackItemType)}},n.prototype.makeScore_61zpoe$=function(t){this.scoreUtil=new EasyScoreUtil,this.scoreUtil.containerElementName=this.parameters.notationContainerName;var e=generateExerciseEasyScoreCode();this.scoreUtil.exercise=e,this.scoreUtil.generatedExercise=this.generatedExercise,pm_log("Setting up score on "+t),this.scoreUtil.setupOnElement(t),this.scoreUtil.setupMetronome(this.parameters.metronomeContainerName),this.scoreUtil.buildTitleElements(t),this.scoreUtil.notateExercise()},n.prototype.toggleState=function(){var t;t=this.exerciseManager.timeKeeper.state,e.equals(t,G())?(this.exerciseManager.createSteppables(),this.exerciseManager.setup(),this.exerciseManager.loadExercise(),this.exerciseManager.run()):e.equals(t,X())?this.exerciseManager.stop():e.equals(t,Y())},n.prototype.doResizeActions=function(){var t,n;pm_log("Resized window w/ container: "+this.parameters.notationContainerName,10);var i=e.isType(t=document.getElementsByTagName("svg")[0],Element)?t:e.throwCCE();null!=(n=i.parentNode)&&n.removeChild(i),listenerApp.makeScore_61zpoe$(this.parameters.notationContainerName)},n.prototype.moveToPosition_14dthe$=function(t){var n,i=e.isType(n=document.getElementById("indicatorCanvas"),HTMLCanvasElement)?n:null;(null!=i?i.getContext("2d"):null).clearRect(0,0,null!=i?i.width:null,null!=i?i.height:null),this.scoreUtil.drawIndicatorLine(i,t)},n.prototype.highlightMetronomeItem_za3lpa$=function(t){var n,i,o,r,a,s=document.getElementsByClassName("metronomeItem");i=(n=ct(0,s.length)).first,o=n.last,r=n.step;for(var l=i;l<=o;l+=r){var c=e.isType(a=s[l],HTMLElement)?a:e.throwCCE();c.className="metronomeItem",t===l&&(c.className=c.className+" highlighted")}},n.prototype.clearFeedbackItems=function(){var t;pm_log("Clearing");for(var n=document.getElementsByClassName("feedbackItem");n.length>0;){var i,o=e.isType(t=n[0],HTMLElement)?t:e.throwCCE();null!=(i=o.parentNode)&&i.removeChild(o)}},n.prototype.addFeedbackItem_k93uln$=function(t,n){var i=this.scoreUtil.getPositionForBeat(t),o=this.scoreUtil.getFeedbackYPosition(i.y);this.scoreUtil.createFeedbackHTMLElement(e.kotlin.collections.copyToArray(n),i.x,o)},n.$metadata$={kind:e.Kind.CLASS,simpleName:"ListenerApp",interfaces:[]},i.$metadata$={kind:e.Kind.INTERFACE,simpleName:"AppSetupParameters",interfaces:[]},o.$metadata$={kind:e.Kind.INTERFACE,simpleName:"AudioAnalyzer",interfaces:[]},r.$metadata$={kind:e.Kind.INTERFACE,simpleName:"GeneratedExercise",interfaces:[]},a.$metadata$={kind:e.Kind.INTERFACE,simpleName:"EasyScoreCode",interfaces:[]},s.$metadata$={kind:e.Kind.CLASS,simpleName:"SimpleJSNoteObject",interfaces:[]},s.prototype.component1=function(){return this.noteNumber},s.prototype.component2=function(){return this.duration},s.prototype.copy_5wr77w$=function(t,e){return new s(void 0===t?this.noteNumber:t,void 0===e?this.duration:e)},s.prototype.toString=function(){return"SimpleJSNoteObject(noteNumber="+e.toString(this.noteNumber)+", duration="+e.toString(this.duration)+")"},s.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.noteNumber)|0,t=31*t+e.hashCode(this.duration)|0},s.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.noteNumber,t.noteNumber)&&e.equals(this.duration,t.duration)},l.$metadata$={kind:e.Kind.CLASS,simpleName:"BeatPosition",interfaces:[]},l.prototype.component1=function(){return this.x},l.prototype.component2=function(){return this.y},l.prototype.copy_lu1900$=function(t,e){return new l(void 0===t?this.x:t,void 0===e?this.y:e)},l.prototype.toString=function(){return"BeatPosition(x="+e.toString(this.x)+", y="+e.toString(this.y)+")"},l.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.x)|0,t=31*t+e.hashCode(this.y)|0},l.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.x,t.x)&&e.equals(this.y,t.y)},c.prototype.applyToExercise_k94nyn$=function(t){var n,i=pt(t.notes),o=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(i,10));for(n=i.iterator();n.hasNext();){var r,a=n.next(),l=o.add_11rb$;t:do{if(0!==p().transposition){r=new s(a.noteNumber+p().transposition|0,a.duration);break t}r=a}while(!1);l.call(o,r)}return t.notes=e.kotlin.collections.copyToArray(o),-1!==this.tempo&&(t.tempo=this.tempo),t},c.$metadata$={kind:e.Kind.OBJECT,simpleName:"UserSettings",interfaces:[]};var Ct=null;u.prototype.loadAudioFile_puj7f4$=function(t,e){var n=new Audio(t);return this.loadedAudio.put_xwzc9p$(e,n),n},u.prototype.playAudioNow_61zpoe$=function(t){pm_log("**** (( Playing...",6);var e=this.loadedAudio.get_11rb$(t);null!=e&&(e.currentTime=0),null!=e&&e.play()},u.prototype.playAudio_bm4lxs$=function(t,e){var n=this.loadedAudio.get_11rb$(t),i=window.setTimeout(h(e,n),e);this.timeoutKeys.add_11rb$(i)},u.prototype.cancelAllAudio=function(){var t;for(t=ut(this.timeoutKeys).iterator();t.hasNext();){var e=t.next();pm_log("Cancelling item... "+e),window.clearTimeout(e)}ht(this.timeoutKeys,m)},u.$metadata$={kind:e.Kind.CLASS,simpleName:"AudioManager",interfaces:[]},d.prototype.getLength=function(){var t,n=6e4/this.tempo,i=this.notes,o=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(i,10));for(t=i.iterator();t.hasNext();){var r=t.next();o.add_11rb$(r.duration)}var a=o.iterator();if(!a.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var s=a.next();a.hasNext();){var l=s;s=a.next()+l}return s*n},d.prototype.prerollLength=function(){return 4*(6e4/this.tempo)},d.$metadata$={kind:e.Kind.CLASS,simpleName:"ExerciseDefinition",interfaces:[]},f.prototype.createSteppables=function(){this.timeKeeper=new H,this.metronome=new R,this.pitchTracker=new J,this.bufferManager=new A,this.comparisonEngine=new T,this.lastAnalysisTimestamp=mt.MIN_VALUE},f.prototype.setup=function(){pm_log("Setup"),listenerApp.clearFeedbackItems(),this.metronome.audioManager=this.audioManager,this.timeKeeper.steppables.add_11rb$(this.metronome),this.timeKeeper.steppables.add_11rb$(this.pitchTracker),this.timeKeeper.analyzers.add_11rb$(this),this.timeKeeper.finishedActions.add_11rb$(g(this)),this.metronome.setup(),this.pitchTracker.setup()},f.prototype.run=function(){this.metronome.start(),this.pitchTracker.start(),this.timeKeeper.start()},f.prototype.stop=function(){this.timeKeeper.stop(),this.metronome.stop(),this.pitchTracker.stop()},f.prototype.loadExercise=function(){var t;pm_log("Loading exericse:");var n=listenerApp.generatedExercise,i=new d;i.tempo=n.tempo;var o,r=n.notes,a=e.kotlin.collections.ArrayList_init_ww73n8$(r.length);for(o=0;o!==r.length;++o){var s=r[o];a.add_11rb$(new j(s.noteNumber,s.duration))}i.notes=dt(a),pm_log("Loaded "+e.toString(i.notes.size)+" notes"),pm_log(i.notes),this.currentExercise=i,null!=(t=this.currentExercise)&&(this.metronome.tempo=t.tempo,this.bufferManager.tempo=t.tempo,this.timeKeeper.runForTime=t.getLength()+t.prerollLength()+this.pitchTracker.latencyTime,this.pitchTracker.lengthOfPrerollToIgnore=t.prerollLength(),pm_log("Loaded exercise of length "+e.toString(this.timeKeeper.runForTime)))},f.prototype.analyze_14dthe$=function(t){var n;if(t-this.lastAnalysisTimestamp>200&&(this.lastAnalysisTimestamp=t,pm_log("Analyzing at "+e.toString(t)),null!=(n=this.currentExercise))){pm_log("Samples length: "+e.toString(this.pitchTracker.samples.size));var i=this.bufferManager.convertSamplesBufferToNotes_mtnj1d$(this.pitchTracker.samples),o=this.comparisonEngine.compareNoteArrays_11i8u3$(n.notes,i);listenerApp.clearFeedbackItems();var r;for(r=o.feedbackItems.iterator();r.hasNext();){var a=r.next(),s=a.beat;listenerApp.addFeedbackItem_k93uln$(s,a.feedbackItemType)}}},f.$metadata$={kind:e.Kind.CLASS,simpleName:"ExerciseManager",interfaces:[tt]},v.prototype.convertSamplesBufferToNotes_av4ikl$=function(t,n){var i,o,r=60/n,a=e.kotlin.collections.ArrayList_init_ww73n8$(),s={v:-1},l=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(o=t.iterator();o.hasNext();){var c=o.next();l.add_11rb$(D().getNoteNumber_14dthe$(c))}var p,u=ft(t,l),h=e.kotlin.collections.ArrayList_init_ww73n8$(),m={v:e.kotlin.collections.ArrayList_init_ww73n8$()};for(p=u.iterator();p.hasNext();){var d=p.next();d.second===s.v?m.v.add_11rb$(d):m.v.size>0&&(h.add_11rb$(m.v),m.v=e.kotlin.collections.ArrayList_init_ww73n8$()),s.v=d.second}m.v.size>0&&h.add_11rb$(m.v);var f,g=e.kotlin.collections.ArrayList_init_ww73n8$();for(f=h.iterator();f.hasNext();){var v=f.next();v.size>r*this.minDurationInBeats*this.sampleRate&&g.add_11rb$(v)}var _=g;gt("Converted into number groups: "+e.toString(_.size)+" from original: "+e.toString(h.size));var y,$=e.kotlin.collections.ArrayList_init_ww73n8$();for(y=_.iterator();y.hasNext();){var w=y.next();e.kotlin.collections.addAll_ipc267$($,w)}var b=$;s.v=-1;var S=0,k=0;for(i=b.iterator();i.hasNext();){var x=i.next(),N=x.second,A=x.first;if(N!==s.v){if(S>0){var T=S/(r*this.sampleRate);k/=S;var C=new j(s.v,T);C.avgFreq=k,a.add_11rb$(C)}k=0,S=-1}k+=A,s.v=N,S=S+1|0}if(S>0){var I=S/(r*this.sampleRate);k/=S;var E=new j(s.v,I);E.avgFreq=k,a.add_11rb$(E)}return console.log("Turned samples into these notes: "+e.toString(a)),a},v.prototype.convertNotesToSamples_jisecs$=function(t,n){var i,o=e.kotlin.collections.ArrayList_init_ww73n8$(),r=60/n,a=e.kotlin.collections.ArrayList_init_ww73n8$();for(i=t.iterator();i.hasNext();){var s,l,c,p,u=i.next();a.add_11rb$(o.size);var h=u.duration*r*this.sampleRate,m=u.getFrequency();l=(s=ct(0,0|h)).first,c=s.last,p=s.step;for(var d=l;d<=c;d+=p)o.add_11rb$(m)}return console.log("Note change indexes: "+e.toString(a)),o},v.$metadata$={kind:e.Kind.OBJECT,simpleName:"BufferManager",interfaces:[]};var It=null;y.prototype.compareNoteArrays_l4hzig$=function(t,n){var i,o,r,a,s,l=new S,c=0;for(i=vt(t).iterator();i.hasNext();){var p=i.next(),u=p.component1(),h=p.component2(),m=-1,d=0,f=0,g=mt.MAX_VALUE;r=(o=_t(n)).first,a=o.last,s=o.step;for(var v=r;v<=a;v+=s){var _=n.get_za3lpa$(v),y=Math.abs(c-f);y<g&&(m=v,d=f,g=y),f+=_.duration}gt("Going to compare ideal index "+u+" to test index "+m);var $=new b(c,e.kotlin.collections.emptyList_287e2$());if(l.feedbackItems.add_11rb$($),-1!==m){l.attempted=l.attempted+1|0;var k=!0,x=h,N=n.get_za3lpa$(m);gt("Durations : "+e.toString(x.duration)+" | "+e.toString(N.duration)),x.duration-N.duration>this.allowableRhythmMargin?(gt("Test subject too short"),k=!1):x.duration-N.duration<-this.allowableRhythmMargin?(gt("Test subject too long"),k=!1):gt("PERFECT"),gt("Starting points : "+e.toString(c)+" | "+e.toString(d)),c-d>this.allowableRhythmMargin?(gt("Test subject rushing"),$.feedbackItemType=yt($.feedbackItemType,new w("rhythm","rushing")),k=!1):c-d<-this.allowableRhythmMargin?(gt("Test subject dragging"),$.feedbackItemType=yt($.feedbackItemType,new w("rhythm","dragging")),k=!1):gt("PERFECT"),gt("Pitch : "+e.toString(x.getFrequency())+" | "+e.toString(N.getFrequency())),gt("Avg freq of test item: "+e.toString(N.avgFreq));var A=N.avgFreq;null!=A&&(A-x.getFrequency()>this.allowableFreqencyMargin?(gt("Test subject sharp"),$.feedbackItemType=yt($.feedbackItemType,new w("pitch","sharp")),k=!1):A-x.getFrequency()<-this.allowableFreqencyMargin?(gt("Test subject flat"),$.feedbackItemType=yt($.feedbackItemType,new w("pitch","flat")),k=!1):gt("PERFECT")),c+=h.duration,k&&(l.correct=l.correct+1|0)}}return gt("---- Results : "+e.toString(l.correct)+"/"+e.toString(l.attempted)),l},y.$metadata$={kind:e.Kind.OBJECT,simpleName:"CompareEngine",interfaces:[]};var Et=null;w.$metadata$={kind:e.Kind.CLASS,simpleName:"FeedbackMetric",interfaces:[]},w.prototype.component1=function(){return this.name},w.prototype.component2=function(){return this.value},w.prototype.copy_puj7f4$=function(t,e){return new w(void 0===t?this.name:t,void 0===e?this.value:e)},w.prototype.toString=function(){return"FeedbackMetric(name="+e.toString(this.name)+", value="+e.toString(this.value)+")"},w.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.name)|0,t=31*t+e.hashCode(this.value)|0},w.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.name,t.name)&&e.equals(this.value,t.value)},b.$metadata$={kind:e.Kind.CLASS,simpleName:"FeedbackItem",interfaces:[]},b.prototype.component1=function(){return this.beat},b.prototype.component2=function(){return this.feedbackItemType},b.prototype.copy_k93uln$=function(t,e){return new b(void 0===t?this.beat:t,void 0===e?this.feedbackItemType:e)},b.prototype.toString=function(){return"FeedbackItem(beat="+e.toString(this.beat)+", feedbackItemType="+e.toString(this.feedbackItemType)+")"},b.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.beat)|0,t=31*t+e.hashCode(this.feedbackItemType)|0},b.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.beat,t.beat)&&e.equals(this.feedbackItemType,t.feedbackItemType)},S.prototype.generateResultForDatabase=function(){var t,n=this.finalResults,i=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(n,10));for(t=n.iterator();t.hasNext();){var o=t.next();i.add_11rb$(o.idealPitch-o.actualPitch)}var r,a=$t(i),s=this.finalResults,l=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(s,10));for(r=s.iterator();r.hasNext();){var c=r.next();l.add_11rb$(c.idealBeat-c.actualBeat)}var p,u=$t(l),h=this.finalResults,m=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(h,10));for(p=h.iterator();p.hasNext();){var d=p.next();m.add_11rb$(d.idealDuration-d.actualDuration)}var f=$t(m);return new k(void 0,void 0,this.correct,this.attempted,a,u,f,this.finalResults)},S.$metadata$={kind:e.Kind.CLASS,simpleName:"CompareResults",interfaces:[]},k.$metadata$={kind:e.Kind.CLASS,simpleName:"ResultsForDatabase",interfaces:[]},k.prototype.component1=function(){return this.userID},k.prototype.component2=function(){return this.exerciseID},k.prototype.component3=function(){return this.correct},k.prototype.component4=function(){return this.attempted},k.prototype.component5=function(){return this.exerciseAveragePitch},k.prototype.component6=function(){return this.exerciseAverageRhythm},k.prototype.component7=function(){return this.exerciseAverageDuration},k.prototype.component8=function(){return this.notePerformances},k.prototype.copy_ch5twz$=function(t,e,n,i,o,r,a,s){return new k(void 0===t?this.userID:t,void 0===e?this.exerciseID:e,void 0===n?this.correct:n,void 0===i?this.attempted:i,void 0===o?this.exerciseAveragePitch:o,void 0===r?this.exerciseAverageRhythm:r,void 0===a?this.exerciseAverageDuration:a,void 0===s?this.notePerformances:s)},k.prototype.toString=function(){return"ResultsForDatabase(userID="+e.toString(this.userID)+", exerciseID="+e.toString(this.exerciseID)+", correct="+e.toString(this.correct)+", attempted="+e.toString(this.attempted)+", exerciseAveragePitch="+e.toString(this.exerciseAveragePitch)+", exerciseAverageRhythm="+e.toString(this.exerciseAverageRhythm)+", exerciseAverageDuration="+e.toString(this.exerciseAverageDuration)+", notePerformances="+e.toString(this.notePerformances)+")"},k.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.userID)|0,t=31*t+e.hashCode(this.exerciseID)|0,t=31*t+e.hashCode(this.correct)|0,t=31*t+e.hashCode(this.attempted)|0,t=31*t+e.hashCode(this.exerciseAveragePitch)|0,t=31*t+e.hashCode(this.exerciseAverageRhythm)|0,t=31*t+e.hashCode(this.exerciseAverageDuration)|0,t=31*t+e.hashCode(this.notePerformances)|0},k.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.userID,t.userID)&&e.equals(this.exerciseID,t.exerciseID)&&e.equals(this.correct,t.correct)&&e.equals(this.attempted,t.attempted)&&e.equals(this.exerciseAveragePitch,t.exerciseAveragePitch)&&e.equals(this.exerciseAverageRhythm,t.exerciseAverageRhythm)&&e.equals(this.exerciseAverageDuration,t.exerciseAverageDuration)&&e.equals(this.notePerformances,t.notePerformances)},x.$metadata$={kind:e.Kind.CLASS,simpleName:"IndividualNotePerformanceInfo",interfaces:[]},x.prototype.component1=function(){return this.idealBeat},x.prototype.component2=function(){return this.actualBeat},x.prototype.component3=function(){return this.idealPitch},x.prototype.component4=function(){return this.actualPitch},x.prototype.component5=function(){return this.idealDuration},x.prototype.component6=function(){return this.actualDuration},x.prototype.copy_15yvbs$=function(t,e,n,i,o,r){return new x(void 0===t?this.idealBeat:t,void 0===e?this.actualBeat:e,void 0===n?this.idealPitch:n,void 0===i?this.actualPitch:i,void 0===o?this.idealDuration:o,void 0===r?this.actualDuration:r)},x.prototype.toString=function(){return"IndividualNotePerformanceInfo(idealBeat="+e.toString(this.idealBeat)+", actualBeat="+e.toString(this.actualBeat)+", idealPitch="+e.toString(this.idealPitch)+", actualPitch="+e.toString(this.actualPitch)+", idealDuration="+e.toString(this.idealDuration)+", actualDuration="+e.toString(this.actualDuration)+")"},x.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.idealBeat)|0,t=31*t+e.hashCode(this.actualBeat)|0,t=31*t+e.hashCode(this.idealPitch)|0,t=31*t+e.hashCode(this.actualPitch)|0,t=31*t+e.hashCode(this.idealDuration)|0,t=31*t+e.hashCode(this.actualDuration)|0},x.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.idealBeat,t.idealBeat)&&e.equals(this.actualBeat,t.actualBeat)&&e.equals(this.idealPitch,t.idealPitch)&&e.equals(this.actualPitch,t.actualPitch)&&e.equals(this.idealDuration,t.idealDuration)&&e.equals(this.actualDuration,t.actualDuration)},N.$metadata$={kind:e.Kind.CLASS,simpleName:"NotePlacement",interfaces:[]},N.prototype.component1=function(){return this.note},N.prototype.component2=function(){return this.positionInBeats},N.prototype.copy_uilc1j$=function(t,e){return new N(void 0===t?this.note:t,void 0===e?this.positionInBeats:e)},N.prototype.toString=function(){return"NotePlacement(note="+e.toString(this.note)+", positionInBeats="+e.toString(this.positionInBeats)+")"},N.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.note)|0,t=31*t+e.hashCode(this.positionInBeats)|0},N.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.note,t.note)&&e.equals(this.positionInBeats,t.positionInBeats)},A.prototype.convertSamplesBufferToNotes_mtnj1d$=function(t){var n=e.kotlin.collections.ArrayList_init_ww73n8$();if(0===t.size)return e.kotlin.collections.emptyList_287e2$();var i=window.performance.now(),o=60/this.tempo,r=t.subList_vux9f0$(0,t.size);pm_log("Converting how many samples: "+e.toString(r.size));var a,s=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(a=r.iterator();a.hasNext();){var l=a.next();s.add_11rb$(l.lengthInSamples)}var c=s.iterator();if(!c.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var p=c.next();c.hasNext();)p=p+c.next()|0;var u=p/this.sampleRate/o;pm_log("Total length of samples in beats: "+u);var h,m=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(h=r.iterator();h.hasNext();){var d=h.next();m.add_11rb$(D().getNoteNumber_14dthe$(d.freq))}var f=ft(r,m);pm_log("After mapping and zipping: "+e.toString(window.performance.now()-i));var g,v=e.kotlin.collections.ArrayList_init_ww73n8$(),_={v:e.kotlin.collections.ArrayList_init_ww73n8$()},y={v:wt.MIN_VALUE};for(g=f.iterator();g.hasNext();){var $=g.next();y.v!==$.second&&(v.add_11rb$(_.v),_.v=e.kotlin.collections.ArrayList_init_ww73n8$()),_.v.add_11rb$($),y.v=$.second}v.add_11rb$(_.v),pm_log("After making pairs: "+e.toString(window.performance.now()-i));var w,b=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(f,10));for(w=f.iterator();w.hasNext();){var S=w.next();b.add_11rb$(S.first.lengthInSamples)}var k=b.iterator();if(!k.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var x=k.next();k.hasNext();)x=x+k.next()|0;var A=x/this.sampleRate/o;pm_log("Total length of collected pairs in beats: "+A);var T,C=e.kotlin.collections.ArrayList_init_ww73n8$();for(T=v.iterator();T.hasNext();){var I=T.next();e.kotlin.collections.addAll_ipc267$(C,I)}var E,P=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(C,10));for(E=C.iterator();E.hasNext();){var L=E.next();P.add_11rb$(L.first.lengthInSamples)}var O=P.iterator();if(!O.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var z=O.next();O.hasNext();)z=z+O.next()|0;var B=z/this.sampleRate/o;pm_log("Total length of groups: "+B);var q,F=e.kotlin.collections.ArrayList_init_ww73n8$();for(q=v.iterator();q.hasNext();){var M=q.next();0!==M.size&&F.add_11rb$(M)}var R,K=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(F,10));for(R=F.iterator();R.hasNext();){var U,J,H=R.next(),V=K.add_11rb$,W=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(H,10));for(J=H.iterator();J.hasNext();){var G=J.next();W.add_11rb$(G.first.lengthInSamples)}var X=W.iterator();if(!X.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var Y=X.next();X.hasNext();)Y=Y+X.next()|0;if(Y<o*this.minDurationInBeats*this.sampleRate){var Q,Z=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(H,10));for(Q=H.iterator();Q.hasNext();){var tt=Q.next();Z.add_11rb$(new bt(tt.first,-100))}U=Z}else U=H;V.call(K,U)}var et=K;pm_log("Converted into number groups: "+e.toString(et.size)+" from original: "+e.toString(v.size));var nt,it=e.kotlin.collections.ArrayList_init_ww73n8$();for(nt=et.iterator();nt.hasNext();){var ot=nt.next();e.kotlin.collections.addAll_ipc267$(it,ot)}var rt,at=it,st=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(at,10));for(rt=at.iterator();rt.hasNext();){var lt=rt.next();st.add_11rb$(lt.first.lengthInSamples)}var ct=st.iterator();if(!ct.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var pt=ct.next();ct.hasNext();)pt=pt+ct.next()|0;var ut=pt/this.sampleRate/o;pm_log("Total length of acceptable groups pairs in beats: "+ut),y.v=-1;var ht,mt={v:0},dt={v:0},gt={v:e.kotlin.collections.ArrayList_init_ww73n8$()};for(ht=at.iterator();ht.hasNext();){var vt=ht.next();if(y.v!==vt.second){var _t=new j(y.v,mt.v/(o*this.sampleRate));dt.v=dt.v/mt.v,_t.avgFreq=dt.v,gt.v.add_11rb$(_t),mt.v=0,dt.v=0}mt.v=mt.v+vt.first.lengthInSamples|0,dt.v+=vt.first.freq*vt.first.lengthInSamples,y.v=vt.second}var yt=new j(y.v,mt.v/(o*this.sampleRate));dt.v=dt.v/mt.v,yt.avgFreq=dt.v,gt.v.add_11rb$(yt);var $t,St=e.kotlin.collections.ArrayList_init_ww73n8$();for($t=gt.v.iterator();$t.hasNext();){var kt=$t.next();0!==kt.duration&&St.add_11rb$(kt)}n.addAll_brywnq$(St);var xt,Nt={v:0},At=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(n,10));for(xt=n.iterator();xt.hasNext();){var Tt=xt.next(),Ct=At.add_11rb$,It=new N(Tt,Nt.v);Nt.v+=Tt.duration,Ct.call(At,It)}var Et,Pt=e.kotlin.collections.ArrayList_init_ww73n8$();for(Et=At.iterator();Et.hasNext();){var Lt=Et.next();-100!==Lt.note.noteNumber&&Pt.add_11rb$(Lt)}var Ot,zt=Pt,Bt=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(n,10));for(Ot=n.iterator();Ot.hasNext();){var qt=Ot.next();Bt.add_11rb$(qt.duration)}var Ft=Bt.iterator();if(!Ft.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var jt=Ft.next();Ft.hasNext();)jt+=Ft.next();var Mt=jt;pm_log("Length of notes in beats: "+Mt);var Dt=window.performance.now();return pm_log("Function total time: "+e.toString(Dt-i)),zt},A.$metadata$={kind:e.Kind.CLASS,simpleName:"IncrementalBufferManager",interfaces:[]},T.prototype.compareNoteArrays_11i8u3$=function(t,n){var i,o,r,a,s,l,c,p,u,h,m,d=new S,f=0,g=-1,v=0;n.size>0&&(v=St(n).positionInBeats+St(n).note.duration);var _=window.performance.now();o=(i=ct(0,t.size)).first,r=i.last,a=i.step;for(var y=o;y<=r;y+=a){var $,k=t.get_za3lpa$(y),A=-1,T=0,C=mt.MAX_VALUE;l=(s=ct(0,n.size)).first,c=s.last,p=s.step;for(var I=l;I<=c;I+=p){$=n.get_za3lpa$(I).positionInBeats;var E=Math.abs(f-$);E<C&&(A=I,T=$,C=E)}if(f>=v){pm_log("Too far");break}A<=g&&pm_log("Already tested here...... "+A+" <= "+g),g=A,pm_log("Going to compare ideal index "+y+" to test index "+A);var P=e.kotlin.collections.ArrayList_init_ww73n8$(),L=new b(f,P);if(d.feedbackItems.add_11rb$(L),-1!==A){d.attempted=d.attempted+1|0;var O=!0,z=k,B=n.get_za3lpa$(A);pm_log("Durations : "+e.toString(z.duration)+" | "+e.toString(B.note.duration)),z.duration-B.note.duration>this.allowableLengthMargin?pm_log("Test subject too short"):z.duration-B.note.duration<-this.allowableLengthMargin?pm_log("Test subject too long"):pm_log("PERFECT"),pm_log("Starting points : "+e.toString(f)+" | "+e.toString(T));var q=-(f-T),F=Math.round(100*q)/100;if(q>this.allowableRhythmMargin?(pm_log("Test subject rushing"),P.add_11rb$(new w("speed","+"+e.toString(F))),O=!1):q<-this.allowableRhythmMargin?(pm_log("Test subject dragging"),P.add_11rb$(new w("speed",""+e.toString(F))),O=!1):pm_log("PERFECT"),pm_log("Notes : "+e.toString(z.noteNumber)+" | "+e.toString(B.note.noteNumber)),B.note.noteNumber===(z.noteNumber+12|0)||B.note.noteNumber===(z.noteNumber-2|0)){pm_log("Octave shifted");var M=new j(z.noteNumber,B.note.duration);B.note.noteNumber<z.noteNumber?M.avgFreq=null!=(u=B.note.avgFreq)?2*u:null:M.avgFreq=null!=(h=B.note.avgFreq)?h/2:null,B=new N(M,B.positionInBeats)}z.noteNumber!==B.note.noteNumber&&pm_log("WRONG NOTE *&*&*&*&*&*&*&*"),pm_log("Pitch : "+e.toString(z.getFrequency())+" | "+e.toString(B.note.getFrequency())),pm_log("Avg freq of test item: "+e.toString(B.note.avgFreq));var R=B.note.avgFreq;if(null!=R){var K=z.getFrequency(),U=D().getFrequencyForNoteNumber_za3lpa$(z.noteNumber+1|0),J=D().getFrequencyForNoteNumber_za3lpa$(z.noteNumber-1|0);if(R-K>0){var H=U-K,V=(R-K)/H*100;pm_log("Sharp by "+H+" ("+V+" cents)"),V>this.allowableCentsMargin&&(pm_log("Test subject sharp"),P.add_11rb$(new w("pitch","+"+e.toString(0|V))),O=!1)}else if(R-z.getFrequency()<0){var W=K-J,G=(K-R)/W*100;pm_log("Flat by "+W+" ("+G+" cents)"),G>this.allowableCentsMargin&&(pm_log("Test subject flat"),P.add_11rb$(new w("pitch","-"+e.toString(0|G))),O=!1)}else pm_log("PERFECT")}var X=new w("Note #",""+e.toString(B.note.noteNumber));P.add_11rb$(X),f+=k.duration,O&&(d.correct=d.correct+1|0);var Y=new x(f,T,z.getFrequency(),null!=(m=B.note.avgFreq)?m:-1,z.duration,B.note.duration);d.finalResults.add_11rb$(Y)}}var Q=window.performance.now();return pm_log("Function total time: "+e.toString(Q-_)),d},T.$metadata$={kind:e.Kind.CLASS,simpleName:"IncrementalComparisonEngine",interfaces:[]};var Pt,Lt;I.$metadata$={kind:e.Kind.CLASS,simpleName:"MarkerType",interfaces:[kt]},I.values=function(){return[P(),L()]},I.valueOf_61zpoe$=function(t){switch(t){case"NoteChange":return P();case"BeatChange":return L();default:e.throwISE("No enum constant com.practicingmusician.models.Slice.MarkerType."+t)}},C.$metadata$={kind:e.Kind.CLASS,simpleName:"Slice",interfaces:[]},O.prototype.makePostRequest_puj7f4$=function(t,e){networkRequest(t,e)},O.prototype.buildAndSendRequest_fhpv3e$=function(t){var e=t.generateResultForDatabase();e.userID=listenerApp.parameters.userID,e.exerciseID=listenerApp.parameters.exerciseID,z().makePostRequest_puj7f4$(listenerApp.parameters.databaseEndpoint,JSON.stringify(e))},O.$metadata$={kind:e.Kind.OBJECT,simpleName:"ListenerNetworkManager",interfaces:[]};var Ot=null;B.$metadata$={kind:e.Kind.CLASS,simpleName:"EasyScoreUtil_Kotlin",interfaces:[]},q.$metadata$={kind:e.Kind.INTERFACE,simpleName:"NotationItem",interfaces:[]},F.$metadata$={kind:e.Kind.CLASS,simpleName:"Barline",interfaces:[q]},j.prototype.getFrequency=function(){return D().getFrequencyForNoteNumber_za3lpa$(this.noteNumber)},M.prototype.getNoteNumber_14dthe$=function(t){return-1===t?-1:this.closestNoteToFrequency_14dthe$(t)},M.prototype.getFrequencyForNoteNumber_za3lpa$=function(t){return p().pitch*Math.pow(2,(t-69)/12)},M.prototype.createAllNotes=function(){var t,n,i,o;Bt=e.kotlin.collections.ArrayList_init_ww73n8$(),n=(t=ct(30,110)).first,i=t.last,o=t.step;for(var r=n;r<=i;r+=o)Bt.add_11rb$(new j(r,1))},M.prototype.closestNoteToFrequency_14dthe$=function(t){var e,n=mt.MAX_VALUE,i=-1;for(e=Bt.iterator();e.hasNext();){var o=e.next(),r=Math.abs(o.getFrequency()-t);if(r<n)n=r,i=o.noteNumber;else if(r>n)break}return i},M.$metadata$={kind:e.Kind.OBJECT,simpleName:"Companion",interfaces:[]};var zt=null;j.$metadata$={kind:e.Kind.CLASS,simpleName:"Note",interfaces:[q]};var Bt;Object.defineProperty(R.prototype,"state",{get:function(){return this.state_t08vao$_0},set:function(t){this.state_t08vao$_0=t}}),R.prototype.setup=function(){this.audioManager.loadAudioFile_puj7f4$("pm-listener/audio/Cowbell.wav",this.audioKey)},R.prototype.start=function(){this.state=X()},R.prototype.stop=function(){this.state=G()},R.prototype.step_zgkg49$=function(t,e){var n=6e4/this.tempo;if(e.runForTime-t<n/2)pm_log("Less than beat size..");else{-1===this.lastBeatOccuredAt&&(this.lastBeatOccuredAt=t-n);var i=this.lastBeatOccuredAt+n,o=t/n;this.updateIndicatorUI_14dthe$(o),t>=i&&(p().metronomeAudioOn&&this.audioManager.playAudioNow_61zpoe$(this.audioKey),this.lastBeatOccuredAt=i,this.updateMetronomeUI_za3lpa$(this.currentBeat),this.currentBeat=this.currentBeat+1|0)}},R.prototype.cancelAllUIUpdates=function(){var t;for(t=ut(this.timeoutKeys).iterator();t.hasNext();){var e=t.next();pm_log("Cancelling item... "+e),window.clearTimeout(e)}ht(this.timeoutKeys,K)},R.prototype.updateIndicatorUI_14dthe$=function(t){listenerApp.moveToPosition_14dthe$(t-this.prerollBeats)},R.prototype.updateMetronomeUI_za3lpa$=function(t){listenerApp.highlightMetronomeItem_za3lpa$(t%this.timeSignature)},R.prototype.getBeatOfTimestamp_14dthe$=function(t){var e,n,i,o,r,a=-1,s=-1;n=(e=_t(this.beatTimes)).first,i=e.last,o=e.step;for(var l=n;l<=i;l+=o){var c=this.beatTimes.get_za3lpa$(l);if(c>t){if(-1==(r=l-1|0))return-1;a=this.beatTimes.get_za3lpa$(r),s=c;break}}return null==a?-1:(t-a)/(s-a)},R.$metadata$={kind:e.Kind.CLASS,simpleName:"Metronome",interfaces:[Z]};var qt;U.$metadata$={kind:e.Kind.CLASS,simpleName:"SampleCollection",interfaces:[]},U.prototype.component1=function(){return this.freq},U.prototype.component2=function(){return this.lengthInSamples},U.prototype.copy_12fank$=function(t,e){return new U(void 0===t?this.freq:t,void 0===e?this.lengthInSamples:e)},U.prototype.toString=function(){return"SampleCollection(freq="+e.toString(this.freq)+", lengthInSamples="+e.toString(this.lengthInSamples)+")"},U.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.freq)|0,t=31*t+e.hashCode(this.lengthInSamples)|0},U.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.freq,t.freq)&&e.equals(this.lengthInSamples,t.lengthInSamples)},J.prototype.setup=function(){},J.prototype.start=function(){this.samplesRecorded=0,this.state=X()},J.prototype.stop=function(){this.state=G()},Object.defineProperty(J.prototype,"state",{get:function(){return this.state_j0gsl6$_0},set:function(t){this.state_j0gsl6$_0=t}}),J.prototype.step_zgkg49$=function(t,n){var i=audioAnalyzer.updatePitch(t);pm_log("Timestamp: "+e.toString(t)),pm_log("Pitch: "+e.toString(i));var o=qt/2;this.stepWithFrequency_88ee24$(t,i,o,this.latencyTime)},J.prototype.stepWithFrequency_88ee24$=function(t,n,i,o){var r=t-i/44100*1e3-o-this.lengthOfPrerollToIgnore;pm_log("Timestamp accounting for preroll "+r);var a=i-this.samplesRecorded+44.1*r;a<0?pm_log("Not filling yet..."):(pm_log("Filling "+e.toString(a)+" with "+n),this.samples.add_11rb$(new U(n,0|a)),this.samplesRecorded=this.samplesRecorded+(0|a)|0)},J.$metadata$={kind:e.Kind.CLASS,simpleName:"PitchTracker",interfaces:[Z]};var Ft,jt,Mt;V.$metadata$={kind:e.Kind.CLASS,simpleName:"TimeKeeperState",interfaces:[kt]},V.values=function(){return[G(),X(),Y()]},V.valueOf_61zpoe$=function(t){switch(t){case"Stopped":return G();case"Running":return X();case"Completed":return Y();default:e.throwISE("No enum constant com.practicingmusician.steppable.TimeKeeper.TimeKeeperState."+t)}},Object.defineProperty(H.prototype,"state",{get:function(){return this.state_k2u27h$_0},set:function(t){if(t===Y()){pm_log("Completed",10),this.state_k2u27h$_0=G();var e;for(e=this.finishedActions.iterator();e.hasNext();)e.next()(!0)}else this.state_k2u27h$_0=t}}),H.prototype.start=function(){this.state=X(),this.requestNextStep()},H.prototype.stop=function(){this.state=G(),this.timeOffSet=-1},H.prototype.requestNextStep=function(){window.requestAnimationFrame(Q(this))},H.prototype.step_14dthe$=function(t){-1===this.timeOffSet&&(this.timeOffSet=t);var n=t-this.timeOffSet;pm_log("Calling step at : "+e.toString(n)+" (raw: "+t+")");var i;for(i=this.steppables.iterator();i.hasNext();){var o=i.next();o.state===X()&&o.step_zgkg49$(n,this)}var r;for(r=this.analyzers.iterator();r.hasNext();)r.next().analyze_14dthe$(n);n>=this.runForTime&&(pm_log("STOPPED ((((((((((((((((((((((((((((((())))))))))))))))))",9),this.state=Y()),this.state!==G()&&this.requestNextStep()},H.prototype.currentTime=function(){return window.performance.now()-this.timeOffSet},H.$metadata$={kind:e.Kind.CLASS,simpleName:"TimeKeeper",interfaces:[]},Z.$metadata$={kind:e.Kind.INTERFACE,simpleName:"TimeKeeperSteppable",interfaces:[]},tt.$metadata$={kind:e.Kind.INTERFACE,simpleName:"TimeKeeperAnalyzer",interfaces:[]},et.prototype.runTest=function(){var t,n=new J;for(t=Tt(new At(24,1024),17).iterator();t.hasNext();)t.next();gt("Samples: "+e.toString(n.samples.size))},et.prototype.toggleTest=function(){},et.$metadata$={kind:e.Kind.OBJECT,simpleName:"PitchTrackerTest",interfaces:[]};var Dt=null;nt.$metadata$={kind:e.Kind.CLASS,simpleName:"PitchTrackerTestClass",interfaces:[]},it.prototype.testShouldBe_3xie8k$=function(t,e){t.attempted===e.attempted&&t.correct===e.correct?gt("---- PASSED -----"):(window.alert("Failed"),gt("----- ***** FAILED ****** -----"))},it.prototype.pitchTrackerTest=function(){var t;gt("***** Pitch tracker test");var n,i=new J,o=rt().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo);for(i.lengthOfPrerollToIgnore=4*this.secondsPerBeat*1e3,gt("Sending preroll"),i.stepWithFrequency_88ee24$(i.lengthOfPrerollToIgnore,1,44.1*i.lengthOfPrerollToIgnore,0),n=i.lengthOfPrerollToIgnore,gt("------"),t=o.iterator();t.hasNext();){var r=t.next();n+=r.lengthInSamples/44100*1e3,gt("sending "+e.toString(r.lengthInSamples)+" at "+n),i.stepWithFrequency_88ee24$(n,r.freq,r.lengthInSamples,0),gt("--------")}var a,s=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10));for(a=o.iterator();a.hasNext();){var l=a.next();s.add_11rb$(l.lengthInSamples)}var c=s.iterator();if(!c.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var p=c.next();c.hasNext();)p=p+c.next()|0;var u,h=p,m=i.samples,d=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(m,10));for(u=m.iterator();u.hasNext();){var f=u.next();d.add_11rb$(f.lengthInSamples)}var g=d.iterator();if(!g.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var v=g.next();g.hasNext();)v=v+g.next()|0;gt("Sample lengths :  "+h+" | "+v);var _=i.samples,y=new A;y.tempo=this.tempo;var $=y.convertSamplesBufferToNotes_mtnj1d$(_),w=rt().addAvgPitchToSamples_j4do5z$($);gt("Comparing exact copies (incremental)...");var b=new S;b.correct=4,b.attempted=4;var k=new T;this.testShouldBe_3xie8k$(b,k.compareNoteArrays_11i8u3$(this.notes,w))},it.prototype.trueIncrementalBufferAndComparisonTest=function(){},it.prototype.trueIncrementalBufferTest=function(){var t=new A;t.tempo=this.tempo;var n=rt().generateExactBufferCollectionWithSize1FromNotes_jisecs$(this.notes,this.tempo);console.log("Starting with "+e.toString(n.size));for(var i=e.kotlin.collections.ArrayList_init_ww73n8$(),o=0;;){var r=o+700|0;r>=n.size&&(r=n.size);var a=n.subList_vux9f0$(o,r);i.addAll_brywnq$(a);var s=t.convertSamplesBufferToNotes_mtnj1d$(i);if(o=o+700|0,r===n.size)break;console.log("Notes after slicing:"),console.log(s)}},it.prototype.trueIncrementalComparisonTest=function(){var t;gt("****** Beginning true incremental test");var n=new A;n.tempo=this.tempo;var i=rt().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),o=n.convertSamplesBufferToNotes_mtnj1d$(i),r=rt().addAvgPitchToSamples_j4do5z$(o);gt("Comparing exact copies (incremental)...");var a=new T;t=r.size;for(var s=0;s<=t;s++){var l=r.subList_vux9f0$(0,s);console.log("Sublist:"+e.toString(l.size)),console.log(l),this.testShouldBe_3xie8k$.call(this,new S(l.size,l.size),a.compareNoteArrays_11i8u3$(this.notes,l))}},it.prototype.exactIncrementalTestInBulk=function(){gt("****** Beginning incremental bulk test");var t=new A;t.tempo=this.tempo;var n=rt().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),i=t.convertSamplesBufferToNotes_mtnj1d$(n),o=rt().addAvgPitchToSamples_j4do5z$(i);gt("Comparing exact copies (incremental)...");var r=new S;r.correct=4,r.attempted=4;var a,s=new T,l=this.testShouldBe_3xie8k$,c=$(),p=this.notes,u=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10));for(a=o.iterator();a.hasNext();){var h=a.next();u.add_11rb$(h.note)}l.call(this,r,c.compareNoteArrays_l4hzig$(p,u)),this.testShouldBe_3xie8k$(r,s.compareNoteArrays_11i8u3$(this.notes,o))},it.prototype.sharpTest=function(){gt("****** Beginning sharp test");var t=new T,n=new A;n.tempo=this.tempo;var i=rt().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),o=n.convertSamplesBufferToNotes_mtnj1d$(i),r=o.get_za3lpa$(1).note.getFrequency(),a=D().getFrequencyForNoteNumber_za3lpa$(o.get_za3lpa$(1).note.noteNumber+1|0),s=a-r,l=s*((t.allowableCentsMargin+1)/100);gt("Original freq: "+e.toString(r)),gt("Next note up "+a+" distance "+s+" to move "+l),o.get_za3lpa$(3).note.avgFreq=r+l;var c=rt().addAvgPitchToSamples_j4do5z$(o);gt("Comparing sharp copy...");var p=new S;p.correct=3,p.attempted=4,this.testShouldBe_3xie8k$(p,t.compareNoteArrays_11i8u3$(this.notes,c))},it.prototype.flatTest=function(){gt("****** Beginning flat test");var t=new T,n=new A;n.tempo=this.tempo;var i=rt().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),o=n.convertSamplesBufferToNotes_mtnj1d$(i),r=o.get_za3lpa$(1).note.getFrequency(),a=D().getFrequencyForNoteNumber_za3lpa$(o.get_za3lpa$(1).note.noteNumber-1|0),s=r-a,l=s*((t.allowableCentsMargin+1)/100);gt("Original freq: "+e.toString(r)),gt("Next note up "+a+" distance "+s+" to move "+l),o.get_za3lpa$(3).note.avgFreq=r-l;var c=rt().addAvgPitchToSamples_j4do5z$(o);gt("Comparing flat copy...");var p=new S;p.correct=3,p.attempted=4,this.testShouldBe_3xie8k$(p,t.compareNoteArrays_11i8u3$(this.notes,c))},it.prototype.rushedTest=function(){gt("****** Beginning rushed test");var t=new T,e=new A;e.tempo=this.tempo;var n=lt([new j(69,.5),new j(81,1-t.allowableRhythmMargin-.01),new j(69,1),new j(81,1)]),i=rt().generateExactBufferCollectionFromNotes_jisecs$(n,this.tempo),o=e.convertSamplesBufferToNotes_mtnj1d$(i),r=rt().addAvgPitchToSamples_j4do5z$(o),a=new S;a.correct=2,a.attempted=4,gt("Comparing rushed..."),this.testShouldBe_3xie8k$(a,t.compareNoteArrays_11i8u3$(this.notes,r))},it.prototype.shortNotesTest=function(){gt("****** Beginning short notes test");var t=new T,e=new A;e.tempo=this.tempo;var n=lt([new j(69,.31),new j(35,.05),new j(69,.14),new j(81,.78),new j(34,.11),new j(35,.11),new j(69,1),new j(81,1)]),i=rt().generateExactBufferCollectionFromNotes_jisecs$(n,this.tempo),o=e.convertSamplesBufferToNotes_mtnj1d$(i),r=rt().addAvgPitchToSamples_j4do5z$(o),a=new S;a.correct=4,a.attempted=4,gt("Comparing short notes..."),this.testShouldBe_3xie8k$(a,t.compareNoteArrays_11i8u3$(this.notes,r))},it.prototype.runTest=function(){return D().createAllNotes(),this.exactIncrementalTestInBulk(),this.rushedTest(),this.shortNotesTest(),this.pitchTrackerTest(),this.trueIncrementalComparisonTest(),this.sharpTest(),this.flatTest(),"Done"},it.$metadata$={kind:e.Kind.OBJECT,simpleName:"SliceTest",interfaces:[]};var Rt=null;ot.prototype.generateExactBufferFromNotes_jisecs$=function(t,e){return _().convertNotesToSamples_jisecs$(t,e)},ot.prototype.generateExactBufferCollectionWithSize1FromNotes_jisecs$=function(t,n){var i,o=60/n,r=e.kotlin.collections.ArrayList_init_ww73n8$(),a=e.kotlin.collections.ArrayList_init_ww73n8$();for(i=t.iterator();i.hasNext();){var s,l,c,p,u=i.next();a.add_11rb$(r.size);var h=u.duration*o*_().sampleRate,m=u.getFrequency();l=(s=ct(0,0|h)).first,c=s.last,p=s.step;for(var d=l;d<=c;d+=p)r.add_11rb$(m)}console.log("Note change indexes: "+e.toString(a));var f,g=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(f=r.iterator();f.hasNext();){var v=f.next(),y=g.add_11rb$,$=new U(v,1);y.call(g,$)}return g},ot.prototype.generateExactBufferCollectionFromNotes_jisecs$=function(t,n){var i,o=60/n,r=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(i=t.iterator();i.hasNext();){var a=i.next(),s=r.add_11rb$,l=new U(a.getFrequency(),a.duration*o*_().sampleRate|0);s.call(r,l)}return r},ot.prototype.addAvgPitchToSamples_j4do5z$=function(t){var n,i=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(n=t.iterator();n.hasNext();){var o=n.next(),r=i.add_11rb$;null==o.note.avgFreq&&(o.note.avgFreq=o.note.getFrequency()),r.call(i,o)}return i},ot.prototype.addPitchVariationToSamples_d3e2cz$=function(t){var n,i=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(n=t.iterator();n.hasNext();){var o=n.next(),r=i.add_11rb$,a=15*Math.random()*2;r.call(i,o+a/2)}return i},ot.prototype.addRhythmVariationToSamples_d3e2cz$=function(t){for(var e=dt(t),n=0;n<=3600;n++)e.removeAt_za3lpa$(0);for(var i=14e3;i<=18e3;i++)e.add_11rb$(e.get_za3lpa$(400));for(var o=13e3;o<=15500;o++)e.removeAt_za3lpa$(0);return e},ot.prototype.addShortItemsThatShouldBeRemoved_d3e2cz$=function(t){for(var e=dt(t),n=0;n<=5;n++)e.add_wxm5ur$(0,2);for(var i=0;i<=15;i++)e.add_wxm5ur$(100,2);for(var o=0;o<=3;o++)e.add_wxm5ur$(1e4,2);return e},ot.$metadata$={kind:e.Kind.OBJECT,simpleName:"TestBufferGenerator",interfaces:[]};var Kt=null,Ut=t.com||(t.com={}),Jt=Ut.practicingmusician||(Ut.practicingmusician={});Jt.ListenerApp=n,Jt.AppSetupParameters=i,Jt.AudioAnalyzer=o,Jt.GeneratedExercise=r,Jt.EasyScoreCode=a,Jt.SimpleJSNoteObject=s,Jt.BeatPosition=l,Object.defineProperty(Jt,"UserSettings",{get:p}),(Jt.audio||(Jt.audio={})).AudioManager=u;var Ht=Jt.exercises||(Jt.exercises={});Ht.ExerciseDefinition=d,Ht.ExerciseManager=f;var Vt=Jt.finals||(Jt.finals={});Object.defineProperty(Vt,"BufferManager",{get:_}),Object.defineProperty(Vt,"CompareEngine",{get:$}),Vt.FeedbackMetric=w,Vt.FeedbackItem=b,Vt.CompareResults=S,Vt.ResultsForDatabase=k,Vt.IndividualNotePerformanceInfo=x,Vt.NotePlacement=N,Vt.IncrementalBufferManager=A,Vt.IncrementalComparisonEngine=T,Object.defineProperty(I,"NoteChange",{get:P}),Object.defineProperty(I,"BeatChange",{get:L}),C.MarkerType=I,(Jt.models||(Jt.models={})).Slice=C;var Wt=Jt.network||(Jt.network={});Object.defineProperty(Wt,"ListenerNetworkManager",{get:z});var Gt=Jt.notes||(Jt.notes={});Gt.EasyScoreUtil_Kotlin=B,Gt.NotationItem=q,Gt.Barline=F,Object.defineProperty(j,"Companion",{get:D}),Gt.Note=j,Object.defineProperty(Gt,"ALL_NOTES",{get:function(){return Bt},set:function(t){Bt=t}});var Xt=Jt.steppable||(Jt.steppable={});Xt.Metronome=R,Object.defineProperty(Xt,"buflen",{get:function(){return qt},set:function(t){qt=t}}),Xt.SampleCollection=U,Xt.PitchTracker=J,Object.defineProperty(V,"Stopped",{get:G}),Object.defineProperty(V,"Running",{get:X}),Object.defineProperty(V,"Completed",{get:Y}),H.TimeKeeperState=V,Xt.TimeKeeper=H,Xt.TimeKeeperSteppable=Z,Xt.TimeKeeperAnalyzer=tt;var Yt=Jt.tests||(Jt.tests={});return Object.defineProperty(Yt,"PitchTrackerTest",{get:function(){return null===Dt&&new et,Dt}}),Yt.PitchTrackerTestClass=nt,Object.defineProperty(Yt,"SliceTest",{get:function(){return null===Rt&&new it,Rt}}),Object.defineProperty(Yt,"TestBufferGenerator",{get:rt}),t.main_kand9s$=at,Bt=e.kotlin.collections.ArrayList_init_ww73n8$(),qt=1024,at(),e.defineModule("PracticingMusician",t),t}(void 0===PracticingMusician?{}:PracticingMusician,kotlin);