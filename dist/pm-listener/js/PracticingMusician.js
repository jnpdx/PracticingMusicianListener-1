if("undefined"==typeof kotlin)throw new Error("Error loading module 'PracticingMusician'. Its dependency 'kotlin' was not found. Please, check whether 'kotlin' is loaded prior to 'PracticingMusician'.");var PracticingMusician=function(t,e){"use strict";function n(){this.scoreUtil=new EasyScoreUtil,this.generatedExercise=this.generatedExercise,this.containerElementName="notationBody",this.audioManager=new p,this.exerciseManager=new d(this.audioManager)}function o(){}function i(){}function r(){}function a(t,e){this.noteNumber=t,this.duration=e}function s(t,e){this.x=t,this.y=e}function l(){St=this,this.metronomeAudioOn=!0,this.transposition=0,this.tempo=-1,this.pitch=440}function c(){return null===St&&new l,St}function p(){this.loadedAudio=e.kotlin.collections.LinkedHashMap_init_q3lmfv$(),this.timeoutKeys=e.kotlin.collections.ArrayList_init_ww73n8$()}function u(t,n){return function(){return pm_log("(( Playing..."+e.toString(t),6),null!=n&&(n.currentTime=0),null!=n?n.play():null}}function m(t){return!0}function h(){this.notes=e.kotlin.collections.ArrayList_init_ww73n8$(),this.notationItems=e.kotlin.collections.ArrayList_init_ww73n8$(),this.tempo=120}function d(t){this.currentExercise=null,this.timeKeeper=new D,this.metronome=new P,this.pitchTracker=new R,this.bufferManager=new S,this.comparisonEngine=new k,this.audioManager=t,pm_log("Init"),this.lastAnalysisTimestamp=st.MIN_VALUE}function f(t){return function(){var n;t.audioManager.cancelAllAudio(),t.metronome.cancelAllUIUpdates();var o=t.pitchTracker.samples.size/44100;pm_log("Total samples recorded: "+e.toString(t.pitchTracker.samples.size)+" length: "+e.toString(o)),t.bufferManager.tempo=t.metronome.tempo;var i=t.bufferManager.convertSamplesBufferToNotes_mtnj1d$(t.pitchTracker.samples);pm_log("Notes: ");var r;for(r=i.iterator();r.hasNext();){var a=r.next();pm_log("Note: "+e.toString(a.note.noteNumber)+" for "+e.toString(a.note.duration)+" at "+e.toString(a.positionInBeats))}if(null!=(n=t.currentExercise)){var s=t;pm_log("Comparing...");var l=s.comparisonEngine.compareNoteArrays_11i8u3$(n.notes,i);listenerApp.clearFeedbackItems();var c;for(c=l.feedbackItems.iterator();c.hasNext();){var p=c.next(),u=p.beat;listenerApp.addFeedbackItem_iww005$(u,p.feedbackItemType)}window.alert("Your results are: "+e.toString(l.correct)+"/"+e.toString(l.attempted)),z().buildAndSendRequest_fhpv3e$(l)}}}function g(){kt=this,this.sampleRate=44100,this.minDurationInBeats=.25}function _(){return null===kt&&new g,kt}function v(){Nt=this,this.allowableFreqencyMargin=10,this.allowableRhythmMargin=.25}function y(){return null===Nt&&new v,Nt}function $(t,e){this.beat=t,this.feedbackItemType=e}function w(t,n){void 0===t&&(t=0),void 0===n&&(n=0),this.c=t,this.a=n,this.correct=this.c,this.attempted=this.a,this.feedbackItems=e.kotlin.collections.ArrayList_init_ww73n8$()}function b(t,e){this.note=t,this.positionInBeats=e}function S(){this.tempo=0,this.sampleRate=44100,this.minDurationInBeats=.25}function k(){this.allowableCentsMargin=40,this.allowableRhythmMargin=.25,this.allowableLengthMargin=.25}function N(t){this.frequency=t,this.markers=null}function x(t,e){_t.call(this),this.name$=t,this.ordinal$=e}function T(){T=function(){},xt=new x("NoteChange",0),Tt=new x("BeatChange",1)}function A(){return T(),xt}function E(){return T(),Tt}function I(t,e,n,o){this.UserID=t,this.ExerciseID=e,this.attempted=n,this.correct=o}function C(){At=this,this.endpoint="localhost",this.mapTest=yt([vt("test",1),vt("test2",4)])}function z(){return null===At&&new C,At}function L(){this.scorePositionInitialX=60,this.scorePositionInitialY=20,this.scorePositionX=0,this.scorePositionY=0,this.positionInLine=0,this.scorePositionCurrentLine=0,this.measureCounter=0,this.exercise=null,this.generatedExercise=this.generatedExercise,this.vf=null,this.registry=null,this.score=null,this.voice=null,this.beam=null,this.contentScaleFactor=1,this.useScaling=!0,this.assumedCanvasWidth=1024,this.barWidth=200,this.barHeight=160,this.firstBarAddition=40,this.barsPerLine=4,this.noteIDNumber=0,this.systems=e.kotlin.collections.ArrayList_init_ww73n8$()}function O(){}function B(){}function F(t,e,n){j(),void 0===n&&(n="none"),this.noteNumber=t,this.duration=e,this.textValue=n,this.avgFreq=null}function q(){Et=this}function j(){return null===Et&&new q,Et}function P(){this.audioKey="metronomeSound",this.audioManager=this.audioManager,this.state_t08vao$_0=V(),this.timeSignature=4,this.prerollBeats=this.timeSignature,this.tempo=120,this.currentBeat=0,this.beatTimes=e.kotlin.collections.ArrayList_init_ww73n8$(),this.lastBeatOccuredAt=-1,this.timeoutKeys=e.kotlin.collections.ArrayList_init_ww73n8$()}function M(t){return!0}function K(t,e){this.freq=t,this.lengthInSamples=e}function R(){this.sampleRate=44100,this.lengthOfPrerollToIgnore=0,this.latencyTime=180,this.samples=e.kotlin.collections.ArrayList_init_ww73n8$(),this.samplesRecorded=0,this.state_j0gsl6$_0=V()}function D(){this.finishedActions=e.kotlin.collections.ArrayList_init_ww73n8$(),this.state_k2u27h$_0=V(),this.steppables=e.kotlin.collections.ArrayList_init_ww73n8$(),this.analyzers=e.kotlin.collections.ArrayList_init_ww73n8$(),this.timeOffSet=-1,this.runForTime=4100}function U(t,e){_t.call(this),this.name$=t,this.ordinal$=e}function J(){J=function(){},zt=new U("Stopped",0),Lt=new U("Running",1)}function V(){return J(),zt}function W(){return J(),Lt}function G(t){return function(e){t.step_14dthe$(e)}}function H(){}function X(){}function Y(){Ot=this}function Q(){this.tracker=new R}function Z(){Bt=this,this.notes=bt([new F(69,.5),new F(81,1),new F(69,1),new F(81,1)]),this.tempo=120,this.secondsPerBeat=60/this.tempo,this.sampleRate=44100,this.bufferLengthInSamples=1024}function tt(){Ft=this}function et(){return null===Ft&&new tt,Ft}function nt(t){}var ot=e.kotlin.ranges.until_dqglrj$,it=e.kotlin.collections.toList_us0mfu$,rt=e.kotlin.collections.reversed_7wnvza$,at=e.kotlin.collections.removeAll_qafx1e$,st=e.kotlin.js.internal.DoubleCompanionObject,lt=e.kotlin.collections.toMutableList_4c7yge$,ct=e.kotlin.collections.zip_45mdf7$,pt=e.kotlin.io.println_s8jyv4$,ut=e.kotlin.collections.withIndex_7wnvza$,mt=e.kotlin.collections.get_indices_gzk92b$,ht=e.kotlin.collections.plus_qloxvw$,dt=e.kotlin.js.internal.IntCompanionObject,ft=e.kotlin.Pair,gt=e.kotlin.collections.last_2p1efm$,_t=e.kotlin.Enum,vt=e.kotlin.to_ujzrz7$,yt=e.kotlin.collections.mapOf_qfcya0$,$t=e.kotlin.ranges.IntRange,wt=e.kotlin.ranges.step_xsgg7u$,bt=e.kotlin.collections.listOf_i5x0yv$;x.prototype=Object.create(_t.prototype),x.prototype.constructor=x,U.prototype=Object.create(_t.prototype),U.prototype.constructor=U,n.prototype.runApp=function(){j().createAllNotes(),audioAnalyzer.setupMedia(),this.generatedExercise=generateExerciseForKotlin(),this.generatedExercise=c().applyToExercise_k94nyn$(this.generatedExercise),this.exerciseManager.loadExercise(),this.makeDomElements()},n.prototype.makeDomElements=function(){var t,e,n,o=document.createElement("canvas");o.id="indicatorCanvas",null!=(t=document.getElementById(this.containerElementName))&&t.appendChild(o);var i=document.createElement("canvas");i.id="feedbackCanvas",null!=(e=document.getElementById(this.containerElementName))&&e.appendChild(i);var r=document.createElement("div");r.id="metronomeItems",null!=(n=document.getElementById("metronomeContainer"))&&n.appendChild(r),this.makeScore_61zpoe$(this.containerElementName)},n.prototype.makeScore_61zpoe$=function(t){this.scoreUtil=new EasyScoreUtil;var e=generateExerciseEasyScoreCode();this.scoreUtil.exercise=e,this.scoreUtil.generatedExercise=this.generatedExercise,this.scoreUtil.setupOnElement(t);this.scoreUtil.setupMetronome("metronomeContainer"),this.scoreUtil.notateExercise()},n.prototype.toggleState=function(){var t;t=this.exerciseManager.timeKeeper.state,e.equals(t,V())?(this.exerciseManager.createSteppables(),this.exerciseManager.setup(),this.exerciseManager.loadExercise(),this.exerciseManager.run()):e.equals(t,W())&&this.exerciseManager.stop()},n.prototype.doResizeActions=function(){var t,n;pm_log("Resized window",10);var o=e.isType(t=document.getElementsByTagName("svg")[0],Element)?t:e.throwCCE();null!=(n=o.parentNode)&&n.removeChild(o),listenerApp.makeScore_61zpoe$(this.containerElementName)},n.prototype.moveToPosition_14dthe$=function(t){var n,o=e.isType(n=document.getElementById("indicatorCanvas"),HTMLCanvasElement)?n:null;(null!=o?o.getContext("2d"):null).clearRect(0,0,null!=o?o.width:null,null!=o?o.height:null),this.scoreUtil.drawIndicatorLine(o,t)},n.prototype.highlightMetronomeItem_za3lpa$=function(t){var n,o,i,r,a,s=document.getElementsByClassName("metronomeItem");o=(n=ot(0,s.length)).first,i=n.last,r=n.step;for(var l=o;l<=i;l+=r){var c=e.isType(a=s[l],HTMLElement)?a:e.throwCCE();c.className="metronomeItem",t===l&&(c.className=c.className+" highlighted")}},n.prototype.clearFeedbackItems=function(){var t,n,o,i,r,a;pm_log("Clearing");var s=e.isType(t=document.getElementById("feedbackCanvas"),HTMLCanvasElement)?t:null;(null!=s?s.getContext("2d"):null).clearRect(0,0,null!=s?s.width:null,null!=s?s.height:null);var l=document.getElementsByClassName("feedbackItem");o=(n=ot(0,l.length)).first,i=n.last,r=n.step;for(var c=o;c<=i;c+=r){var p=l.item(c);null!=(a=null!=p?p.parentNode:null)&&a.removeChild(p)}},n.prototype.addFeedbackItem_iww005$=function(t,n){var o=this.scoreUtil.getPositionForBeat(t),i=this.scoreUtil.getFeedbackYPosition(o.y);this.scoreUtil.createFeedbackHTMLElement(e.kotlin.collections.copyToArray(n),o.x,i)},n.$metadata$={kind:e.Kind.CLASS,simpleName:"ListenerApp",interfaces:[]},o.$metadata$={kind:e.Kind.INTERFACE,simpleName:"AudioAnalyzer",interfaces:[]},i.$metadata$={kind:e.Kind.INTERFACE,simpleName:"GeneratedExercise",interfaces:[]},r.$metadata$={kind:e.Kind.INTERFACE,simpleName:"EasyScoreCode",interfaces:[]},a.$metadata$={kind:e.Kind.CLASS,simpleName:"SimpleJSNoteObject",interfaces:[]},a.prototype.component1=function(){return this.noteNumber},a.prototype.component2=function(){return this.duration},a.prototype.copy_5wr77w$=function(t,e){return new a(void 0===t?this.noteNumber:t,void 0===e?this.duration:e)},a.prototype.toString=function(){return"SimpleJSNoteObject(noteNumber="+e.toString(this.noteNumber)+", duration="+e.toString(this.duration)+")"},a.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.noteNumber)|0,t=31*t+e.hashCode(this.duration)|0},a.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.noteNumber,t.noteNumber)&&e.equals(this.duration,t.duration)},s.$metadata$={kind:e.Kind.CLASS,simpleName:"BeatPosition",interfaces:[]},s.prototype.component1=function(){return this.x},s.prototype.component2=function(){return this.y},s.prototype.copy_lu1900$=function(t,e){return new s(void 0===t?this.x:t,void 0===e?this.y:e)},s.prototype.toString=function(){return"BeatPosition(x="+e.toString(this.x)+", y="+e.toString(this.y)+")"},s.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.x)|0,t=31*t+e.hashCode(this.y)|0},s.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.x,t.x)&&e.equals(this.y,t.y)},l.prototype.applyToExercise_k94nyn$=function(t){var n,o=it(t.notes),i=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10));for(n=o.iterator();n.hasNext();){var r,s=n.next(),l=i.add_11rb$;t:do{if(0!==c().transposition){r=new a(s.noteNumber+c().transposition|0,s.duration);break t}r=s}while(!1);l.call(i,r)}return t.notes=e.kotlin.collections.copyToArray(i),-1!==this.tempo&&(t.tempo=this.tempo),t},l.$metadata$={kind:e.Kind.OBJECT,simpleName:"UserSettings",interfaces:[]};var St=null;p.prototype.loadAudioFile_puj7f4$=function(t,e){var n=new Audio(t);return this.loadedAudio.put_xwzc9p$(e,n),n},p.prototype.playAudioNow_61zpoe$=function(t){pm_log("**** (( Playing...",6);var e=this.loadedAudio.get_11rb$(t);null!=e&&(e.currentTime=0),null!=e&&e.play()},p.prototype.playAudio_bm4lxs$=function(t,e){var n=this.loadedAudio.get_11rb$(t),o=window.setTimeout(u(e,n),e);this.timeoutKeys.add_11rb$(o)},p.prototype.cancelAllAudio=function(){var t;for(t=rt(this.timeoutKeys).iterator();t.hasNext();){var e=t.next();pm_log("Cancelling item... "+e),window.clearTimeout(e)}at(this.timeoutKeys,m)},p.$metadata$={kind:e.Kind.CLASS,simpleName:"AudioManager",interfaces:[]},h.prototype.getLength=function(){var t,n=6e4/this.tempo,o=this.notes,i=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10));for(t=o.iterator();t.hasNext();){var r=t.next();i.add_11rb$(r.duration)}var a=i.iterator();if(!a.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var s=a.next();a.hasNext();){var l=s;s=a.next()+l}return s*n},h.prototype.prerollLength=function(){return 4*(6e4/this.tempo)},h.$metadata$={kind:e.Kind.CLASS,simpleName:"ExerciseDefinition",interfaces:[]},d.prototype.createSteppables=function(){this.timeKeeper=new D,this.metronome=new P,this.pitchTracker=new R,this.bufferManager=new S,this.comparisonEngine=new k,this.lastAnalysisTimestamp=st.MIN_VALUE},d.prototype.setup=function(){pm_log("Setup"),listenerApp.clearFeedbackItems(),this.metronome.audioManager=this.audioManager,this.timeKeeper.steppables.add_11rb$(this.metronome),this.timeKeeper.steppables.add_11rb$(this.pitchTracker),this.timeKeeper.analyzers.add_11rb$(this),this.timeKeeper.finishedActions.add_11rb$(f(this)),this.metronome.setup(),this.pitchTracker.setup()},d.prototype.run=function(){this.metronome.start(),this.pitchTracker.start(),this.timeKeeper.start()},d.prototype.stop=function(){this.timeKeeper.stop(),this.metronome.stop(),this.pitchTracker.stop()},d.prototype.loadExercise=function(){var t;pm_log("Loading exericse:");var n=listenerApp.generatedExercise,o=new h;o.tempo=n.tempo;var i,r=n.notes,a=e.kotlin.collections.ArrayList_init_ww73n8$(r.length);for(i=0;i!==r.length;++i){var s=r[i];a.add_11rb$(new F(s.noteNumber,s.duration))}o.notes=lt(a),pm_log("Loaded "+e.toString(o.notes.size)+" notes"),pm_log(o.notes),this.currentExercise=o,null!=(t=this.currentExercise)&&(this.metronome.tempo=t.tempo,this.bufferManager.tempo=t.tempo,this.timeKeeper.runForTime=t.getLength()+t.prerollLength()+this.pitchTracker.latencyTime,this.pitchTracker.lengthOfPrerollToIgnore=t.prerollLength(),pm_log("Loaded exercise of length "+e.toString(this.timeKeeper.runForTime)))},d.prototype.analyze_14dthe$=function(t){var n;if(t-this.lastAnalysisTimestamp>200&&(this.lastAnalysisTimestamp=t,pm_log("Analyzing at "+e.toString(t)),null!=(n=this.currentExercise))){pm_log("Samples length: "+e.toString(this.pitchTracker.samples.size));var o=this.bufferManager.convertSamplesBufferToNotes_mtnj1d$(this.pitchTracker.samples),i=this.comparisonEngine.compareNoteArrays_11i8u3$(n.notes,o);listenerApp.clearFeedbackItems();var r;for(r=i.feedbackItems.iterator();r.hasNext();){var a=r.next(),s=a.beat;listenerApp.addFeedbackItem_iww005$(s,a.feedbackItemType)}}},d.$metadata$={kind:e.Kind.CLASS,simpleName:"ExerciseManager",interfaces:[X]},g.prototype.convertSamplesBufferToNotes_av4ikl$=function(t,n){var o,i,r=60/n,a=e.kotlin.collections.ArrayList_init_ww73n8$(),s={v:-1},l=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(i=t.iterator();i.hasNext();){var c=i.next();l.add_11rb$(j().getNoteNumber_14dthe$(c))}var p,u=ct(t,l),m=e.kotlin.collections.ArrayList_init_ww73n8$(),h={v:e.kotlin.collections.ArrayList_init_ww73n8$()};for(p=u.iterator();p.hasNext();){var d=p.next();d.second===s.v?h.v.add_11rb$(d):h.v.size>0&&(m.add_11rb$(h.v),h.v=e.kotlin.collections.ArrayList_init_ww73n8$()),s.v=d.second}h.v.size>0&&m.add_11rb$(h.v);var f,g=e.kotlin.collections.ArrayList_init_ww73n8$();for(f=m.iterator();f.hasNext();){var _=f.next();_.size>r*this.minDurationInBeats*this.sampleRate&&g.add_11rb$(_)}var v=g;pt("Converted into number groups: "+e.toString(v.size)+" from original: "+e.toString(m.size));var y,$=e.kotlin.collections.ArrayList_init_ww73n8$();for(y=v.iterator();y.hasNext();){var w=y.next();e.kotlin.collections.addAll_ipc267$($,w)}var b=$;s.v=-1;var S=0,k=0;for(o=b.iterator();o.hasNext();){var N=o.next(),x=N.second,T=N.first;if(x!==s.v){if(S>0){var A=S/(r*this.sampleRate);k/=S;var E=new F(s.v,A);E.avgFreq=k,a.add_11rb$(E)}k=0,S=-1}k+=T,s.v=x,S=S+1|0}if(S>0){var I=S/(r*this.sampleRate);k/=S;var C=new F(s.v,I);C.avgFreq=k,a.add_11rb$(C)}return console.log("Turned samples into these notes: "+e.toString(a)),a},g.prototype.convertNotesToSamples_jisecs$=function(t,n){var o,i=e.kotlin.collections.ArrayList_init_ww73n8$(),r=60/n,a=e.kotlin.collections.ArrayList_init_ww73n8$();for(o=t.iterator();o.hasNext();){var s,l,c,p,u=o.next();a.add_11rb$(i.size);var m=u.duration*r*this.sampleRate,h=u.getFrequency();l=(s=ot(0,0|m)).first,c=s.last,p=s.step;for(var d=l;d<=c;d+=p)i.add_11rb$(h)}return console.log("Note change indexes: "+e.toString(a)),i},g.$metadata$={kind:e.Kind.OBJECT,simpleName:"BufferManager",interfaces:[]};var kt=null;v.prototype.compareNoteArrays_l4hzig$=function(t,n){var o,i,r,a,s,l=new w,c=0;for(o=ut(t).iterator();o.hasNext();){var p=o.next(),u=p.component1(),m=p.component2(),h=-1,d=0,f=0,g=st.MAX_VALUE;r=(i=mt(n)).first,a=i.last,s=i.step;for(var _=r;_<=a;_+=s){var v=n.get_za3lpa$(_),y=Math.abs(c-f);y<g&&(h=_,d=f,g=y),f+=v.duration}pt("Going to compare ideal index "+u+" to test index "+h);var b=new $(c,e.kotlin.collections.emptyList_287e2$());if(l.feedbackItems.add_11rb$(b),-1!==h){l.attempted=l.attempted+1|0;var S=!0,k=m,N=n.get_za3lpa$(h);pt("Durations : "+e.toString(k.duration)+" | "+e.toString(N.duration)),k.duration-N.duration>this.allowableRhythmMargin?(pt("Test subject too short"),S=!1):k.duration-N.duration<-this.allowableRhythmMargin?(pt("Test subject too long"),S=!1):pt("PERFECT"),pt("Starting points : "+e.toString(c)+" | "+e.toString(d)),c-d>this.allowableRhythmMargin?(pt("Test subject rushing"),b.feedbackItemType=ht(b.feedbackItemType,">"),S=!1):c-d<-this.allowableRhythmMargin?(pt("Test subject dragging"),b.feedbackItemType=ht(b.feedbackItemType,"<"),S=!1):pt("PERFECT"),pt("Pitch : "+e.toString(k.getFrequency())+" | "+e.toString(N.getFrequency())),pt("Avg freq of test item: "+e.toString(N.avgFreq));var x=N.avgFreq;null!=x&&(x-k.getFrequency()>this.allowableFreqencyMargin?(pt("Test subject sharp"),b.feedbackItemType=ht(b.feedbackItemType,"^"),S=!1):x-k.getFrequency()<-this.allowableFreqencyMargin?(pt("Test subject flat"),b.feedbackItemType=ht(b.feedbackItemType,"_"),S=!1):pt("PERFECT")),c+=m.duration,S&&(l.correct=l.correct+1|0)}}return pt("---- Results : "+e.toString(l.correct)+"/"+e.toString(l.attempted)),l},v.$metadata$={kind:e.Kind.OBJECT,simpleName:"CompareEngine",interfaces:[]};var Nt=null;$.$metadata$={kind:e.Kind.CLASS,simpleName:"FeedbackItem",interfaces:[]},$.prototype.component1=function(){return this.beat},$.prototype.component2=function(){return this.feedbackItemType},$.prototype.copy_iww005$=function(t,e){return new $(void 0===t?this.beat:t,void 0===e?this.feedbackItemType:e)},$.prototype.toString=function(){return"FeedbackItem(beat="+e.toString(this.beat)+", feedbackItemType="+e.toString(this.feedbackItemType)+")"},$.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.beat)|0,t=31*t+e.hashCode(this.feedbackItemType)|0},$.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.beat,t.beat)&&e.equals(this.feedbackItemType,t.feedbackItemType)},w.$metadata$={kind:e.Kind.CLASS,simpleName:"CompareResults",interfaces:[]},b.$metadata$={kind:e.Kind.CLASS,simpleName:"NotePlacement",interfaces:[]},b.prototype.component1=function(){return this.note},b.prototype.component2=function(){return this.positionInBeats},b.prototype.copy_uilc1j$=function(t,e){return new b(void 0===t?this.note:t,void 0===e?this.positionInBeats:e)},b.prototype.toString=function(){return"NotePlacement(note="+e.toString(this.note)+", positionInBeats="+e.toString(this.positionInBeats)+")"},b.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.note)|0,t=31*t+e.hashCode(this.positionInBeats)|0},b.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.note,t.note)&&e.equals(this.positionInBeats,t.positionInBeats)},S.prototype.convertSamplesBufferToNotes_mtnj1d$=function(t){var n=e.kotlin.collections.ArrayList_init_ww73n8$();if(0===t.size)return e.kotlin.collections.emptyList_287e2$();var o=window.performance.now(),i=60/this.tempo,r=t.subList_vux9f0$(0,t.size);pm_log("Converting how many samples: "+e.toString(r.size));var a,s=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(a=r.iterator();a.hasNext();){var l=a.next();s.add_11rb$(l.lengthInSamples)}var c=s.iterator();if(!c.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var p=c.next();c.hasNext();)p=p+c.next()|0;var u=p/this.sampleRate/i;pm_log("Total length of samples in beats: "+u);var m,h=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(m=r.iterator();m.hasNext();){var d=m.next();h.add_11rb$(j().getNoteNumber_14dthe$(d.freq))}var f=ct(r,h);pm_log("After mapping and zipping: "+e.toString(window.performance.now()-o));var g,_=e.kotlin.collections.ArrayList_init_ww73n8$(),v={v:e.kotlin.collections.ArrayList_init_ww73n8$()},y={v:dt.MIN_VALUE};for(g=f.iterator();g.hasNext();){var $=g.next();y.v!==$.second&&(_.add_11rb$(v.v),v.v=e.kotlin.collections.ArrayList_init_ww73n8$()),v.v.add_11rb$($),y.v=$.second}_.add_11rb$(v.v),pm_log("After making pairs: "+e.toString(window.performance.now()-o));var w,S=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(f,10));for(w=f.iterator();w.hasNext();){var k=w.next();S.add_11rb$(k.first.lengthInSamples)}var N=S.iterator();if(!N.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var x=N.next();N.hasNext();)x=x+N.next()|0;var T=x/this.sampleRate/i;pm_log("Total length of collected pairs in beats: "+T);var A,E=e.kotlin.collections.ArrayList_init_ww73n8$();for(A=_.iterator();A.hasNext();){var I=A.next();e.kotlin.collections.addAll_ipc267$(E,I)}var C,z=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(E,10));for(C=E.iterator();C.hasNext();){var L=C.next();z.add_11rb$(L.first.lengthInSamples)}var O=z.iterator();if(!O.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var B=O.next();O.hasNext();)B=B+O.next()|0;var q=B/this.sampleRate/i;pm_log("Total length of groups: "+q);var P,M=e.kotlin.collections.ArrayList_init_ww73n8$();for(P=_.iterator();P.hasNext();){var K=P.next();0!==K.size&&M.add_11rb$(K)}var R,D=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(M,10));for(R=M.iterator();R.hasNext();){var U,J,V=R.next(),W=D.add_11rb$,G=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(V,10));for(J=V.iterator();J.hasNext();){var H=J.next();G.add_11rb$(H.first.lengthInSamples)}var X=G.iterator();if(!X.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var Y=X.next();X.hasNext();)Y=Y+X.next()|0;if(Y<i*this.minDurationInBeats*this.sampleRate){var Q,Z=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(V,10));for(Q=V.iterator();Q.hasNext();){var tt=Q.next();Z.add_11rb$(new ft(tt.first,-100))}U=Z}else U=V;W.call(D,U)}var et=D;pm_log("Converted into number groups: "+e.toString(et.size)+" from original: "+e.toString(_.size));var nt,ot=e.kotlin.collections.ArrayList_init_ww73n8$();for(nt=et.iterator();nt.hasNext();){var it=nt.next();e.kotlin.collections.addAll_ipc267$(ot,it)}var rt,at=ot,st=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(at,10));for(rt=at.iterator();rt.hasNext();){var lt=rt.next();st.add_11rb$(lt.first.lengthInSamples)}var pt=st.iterator();if(!pt.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var ut=pt.next();pt.hasNext();)ut=ut+pt.next()|0;var mt=ut/this.sampleRate/i;pm_log("Total length of acceptable groups pairs in beats: "+mt),y.v=-1;var ht,gt={v:0},_t={v:0},vt={v:e.kotlin.collections.ArrayList_init_ww73n8$()};for(ht=at.iterator();ht.hasNext();){var yt=ht.next();if(y.v!==yt.second){var $t=new F(y.v,gt.v/(i*this.sampleRate));_t.v=_t.v/gt.v,$t.avgFreq=_t.v,vt.v.add_11rb$($t),gt.v=0,_t.v=0}gt.v=gt.v+yt.first.lengthInSamples|0,_t.v+=yt.first.freq*yt.first.lengthInSamples,y.v=yt.second}var wt=new F(y.v,gt.v/(i*this.sampleRate));_t.v=_t.v/gt.v,wt.avgFreq=_t.v,vt.v.add_11rb$(wt);var bt,St=e.kotlin.collections.ArrayList_init_ww73n8$();for(bt=vt.v.iterator();bt.hasNext();){var kt=bt.next();0!==kt.duration&&St.add_11rb$(kt)}n.addAll_brywnq$(St);var Nt,xt={v:0},Tt=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(n,10));for(Nt=n.iterator();Nt.hasNext();){var At=Nt.next(),Et=Tt.add_11rb$,It=new b(At,xt.v);xt.v+=At.duration,Et.call(Tt,It)}var Ct,zt=e.kotlin.collections.ArrayList_init_ww73n8$();for(Ct=Tt.iterator();Ct.hasNext();){var Lt=Ct.next();-100!==Lt.note.noteNumber&&zt.add_11rb$(Lt)}var Ot,Bt=zt,Ft=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(n,10));for(Ot=n.iterator();Ot.hasNext();){var qt=Ot.next();Ft.add_11rb$(qt.duration)}var jt=Ft.iterator();if(!jt.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var Pt=jt.next();jt.hasNext();)Pt+=jt.next();var Mt=Pt;pm_log("Length of notes in beats: "+Mt);var Kt=window.performance.now();return pm_log("Function total time: "+e.toString(Kt-o)),Bt},S.$metadata$={kind:e.Kind.CLASS,simpleName:"IncrementalBufferManager",interfaces:[]},k.prototype.compareNoteArrays_11i8u3$=function(t,n){var o,i,r,a,s,l,c,p,u,m,h=new w,d=0,f=-1,g=0;n.size>0&&(g=gt(n).positionInBeats+gt(n).note.duration);var _=window.performance.now();i=(o=ot(0,t.size)).first,r=o.last,a=o.step;for(var v=i;v<=r;v+=a){var y,S=t.get_za3lpa$(v),k=-1,N=0,x=st.MAX_VALUE;l=(s=ot(0,n.size)).first,c=s.last,p=s.step;for(var T=l;T<=c;T+=p){y=n.get_za3lpa$(T).positionInBeats;var A=Math.abs(d-y);A<x&&(k=T,N=y,x=A)}if(d>=g){pm_log("Too far");break}k<=f&&pm_log("Already tested here...... "+k+" <= "+f),f=k,pm_log("Going to compare ideal index "+v+" to test index "+k);var E=e.kotlin.collections.ArrayList_init_ww73n8$(),I=new $(d,E);if(h.feedbackItems.add_11rb$(I),-1!==k){h.attempted=h.attempted+1|0;var C=!0,z=S,L=n.get_za3lpa$(k);if(pm_log("Durations : "+e.toString(z.duration)+" | "+e.toString(L.note.duration)),z.duration-L.note.duration>this.allowableLengthMargin?pm_log("Test subject too short"):z.duration-L.note.duration<-this.allowableLengthMargin?pm_log("Test subject too long"):pm_log("PERFECT"),pm_log("Starting points : "+e.toString(d)+" | "+e.toString(N)),d-N>this.allowableRhythmMargin?(pm_log("Test subject rushing"),E.add_11rb$(">"),C=!1):d-N<-this.allowableRhythmMargin?(pm_log("Test subject dragging"),E.add_11rb$("<"),C=!1):pm_log("PERFECT"),pm_log("Notes : "+e.toString(z.noteNumber)+" | "+e.toString(L.note.noteNumber)),L.note.noteNumber===(z.noteNumber+12|0)||L.note.noteNumber===(z.noteNumber-2|0)){pm_log("Octave shifted");var O=new F(z.noteNumber,L.note.duration);L.note.noteNumber<z.noteNumber?O.avgFreq=null!=(u=L.note.avgFreq)?2*u:null:O.avgFreq=null!=(m=L.note.avgFreq)?m/2:null,L=new b(O,L.positionInBeats)}z.noteNumber!==L.note.noteNumber&&pm_log("WRONG NOTE *&*&*&*&*&*&*&*"),pm_log("Pitch : "+e.toString(z.getFrequency())+" | "+e.toString(L.note.getFrequency())),pm_log("Avg freq of test item: "+e.toString(L.note.avgFreq));var B=L.note.avgFreq;if(null!=B){var q=z.getFrequency(),P=j().getFrequencyForNoteNumber_za3lpa$(z.noteNumber+1|0),M=j().getFrequencyForNoteNumber_za3lpa$(z.noteNumber-1|0);if(B-q>0){var K=P-q,R=(B-q)/K*100;pm_log("Sharp by "+K+" ("+R+" cents)"),R>this.allowableCentsMargin&&(pm_log("Test subject sharp"),E.add_11rb$("^"),C=!1)}else if(B-z.getFrequency()<0){var D=q-M,U=(q-B)/D*100;pm_log("Flat by "+D+" ("+U+" cents)"),U>this.allowableCentsMargin&&(pm_log("Test subject flat"),E.add_11rb$("_"),C=!1)}else pm_log("PERFECT")}E.add_11rb$(""+e.toString(L.note.noteNumber)),d+=S.duration,C&&(h.correct=h.correct+1|0)}}pm_log("---- Results : "+e.toString(h.correct)+"/"+e.toString(h.attempted));var J=window.performance.now();return pm_log("Function total time: "+e.toString(J-_)),h},k.$metadata$={kind:e.Kind.CLASS,simpleName:"IncrementalComparisonEngine",interfaces:[]};var xt,Tt;x.$metadata$={kind:e.Kind.CLASS,simpleName:"MarkerType",interfaces:[_t]},x.values=function(){return[A(),E()]},x.valueOf_61zpoe$=function(t){switch(t){case"NoteChange":return A();case"BeatChange":return E();default:e.throwISE("No enum constant com.practicingmusician.models.Slice.MarkerType."+t)}},N.$metadata$={kind:e.Kind.CLASS,simpleName:"Slice",interfaces:[]},I.$metadata$={kind:e.Kind.CLASS,simpleName:"NetworkRequestTransportObject",interfaces:[]},I.prototype.component1=function(){return this.UserID},I.prototype.component2=function(){return this.ExerciseID},I.prototype.component3=function(){return this.attempted},I.prototype.component4=function(){return this.correct},I.prototype.copy_tjonv8$=function(t,e,n,o){return new I(void 0===t?this.UserID:t,void 0===e?this.ExerciseID:e,void 0===n?this.attempted:n,void 0===o?this.correct:o)},I.prototype.toString=function(){return"NetworkRequestTransportObject(UserID="+e.toString(this.UserID)+", ExerciseID="+e.toString(this.ExerciseID)+", attempted="+e.toString(this.attempted)+", correct="+e.toString(this.correct)+")"},I.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.UserID)|0,t=31*t+e.hashCode(this.ExerciseID)|0,t=31*t+e.hashCode(this.attempted)|0,t=31*t+e.hashCode(this.correct)|0},I.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.UserID,t.UserID)&&e.equals(this.ExerciseID,t.ExerciseID)&&e.equals(this.attempted,t.attempted)&&e.equals(this.correct,t.correct)},C.prototype.makePostRequest_puj7f4$=function(t,e){networkRequest(t,e)},C.prototype.buildAndSendRequest_fhpv3e$=function(t){var e=new I(1,1,t.attempted,t.correct);z().makePostRequest_puj7f4$(this.endpoint,JSON.stringify(e))},C.$metadata$={kind:e.Kind.OBJECT,simpleName:"ListenerNetworkManager",interfaces:[]};var At=null;L.$metadata$={kind:e.Kind.CLASS,simpleName:"EasyScoreUtil_Kotlin",interfaces:[]},O.$metadata$={kind:e.Kind.INTERFACE,simpleName:"NotationItem",interfaces:[]},B.$metadata$={kind:e.Kind.CLASS,simpleName:"Barline",interfaces:[O]},F.prototype.getFrequency=function(){return j().getFrequencyForNoteNumber_za3lpa$(this.noteNumber)},q.prototype.getNoteNumber_14dthe$=function(t){return-1===t?-1:this.closestNoteToFrequency_14dthe$(t)},q.prototype.getFrequencyForNoteNumber_za3lpa$=function(t){return c().pitch*Math.pow(2,(t-69)/12)},q.prototype.createAllNotes=function(){var t,n,o,i;It=e.kotlin.collections.ArrayList_init_ww73n8$(),n=(t=ot(30,110)).first,o=t.last,i=t.step;for(var r=n;r<=o;r+=i)It.add_11rb$(new F(r,1))},q.prototype.closestNoteToFrequency_14dthe$=function(t){var e,n=st.MAX_VALUE,o=-1;for(e=It.iterator();e.hasNext();){var i=e.next(),r=Math.abs(i.getFrequency()-t);if(r<n)n=r,o=i.noteNumber;else if(r>n)break}return o},q.$metadata$={kind:e.Kind.OBJECT,simpleName:"Companion",interfaces:[]};var Et=null;F.$metadata$={kind:e.Kind.CLASS,simpleName:"Note",interfaces:[O]};var It;Object.defineProperty(P.prototype,"state",{get:function(){return this.state_t08vao$_0},set:function(t){this.state_t08vao$_0=t}}),P.prototype.setup=function(){this.audioManager.loadAudioFile_puj7f4$("pm-listener/audio/Cowbell.wav",this.audioKey)},P.prototype.start=function(){this.state=W()},P.prototype.stop=function(){this.state=V()},P.prototype.step_zgkg49$=function(t,e){var n=6e4/this.tempo;if(e.runForTime-t<n/2)pm_log("Less than beat size..");else{-1===this.lastBeatOccuredAt&&(this.lastBeatOccuredAt=t-n);var o=this.lastBeatOccuredAt+n,i=t/n;this.updateIndicatorUI_14dthe$(i),t>=o&&(c().metronomeAudioOn&&this.audioManager.playAudioNow_61zpoe$(this.audioKey),this.lastBeatOccuredAt=o,this.updateMetronomeUI_za3lpa$(this.currentBeat),this.currentBeat=this.currentBeat+1|0)}},P.prototype.cancelAllUIUpdates=function(){var t;for(t=rt(this.timeoutKeys).iterator();t.hasNext();){var e=t.next();pm_log("Cancelling item... "+e),window.clearTimeout(e)}at(this.timeoutKeys,M)},P.prototype.updateIndicatorUI_14dthe$=function(t){listenerApp.moveToPosition_14dthe$(t-this.prerollBeats)},P.prototype.updateMetronomeUI_za3lpa$=function(t){listenerApp.highlightMetronomeItem_za3lpa$(t%this.timeSignature)},P.prototype.getBeatOfTimestamp_14dthe$=function(t){var e,n,o,i,r,a=-1,s=-1;n=(e=mt(this.beatTimes)).first,o=e.last,i=e.step;for(var l=n;l<=o;l+=i){var c=this.beatTimes.get_za3lpa$(l);if(c>t){if(-1==(r=l-1|0))return-1;a=this.beatTimes.get_za3lpa$(r),s=c;break}}return null==a?-1:(t-a)/(s-a)},P.$metadata$={kind:e.Kind.CLASS,simpleName:"Metronome",interfaces:[H]};var Ct;K.$metadata$={kind:e.Kind.CLASS,simpleName:"SampleCollection",interfaces:[]},K.prototype.component1=function(){return this.freq},K.prototype.component2=function(){return this.lengthInSamples},K.prototype.copy_12fank$=function(t,e){return new K(void 0===t?this.freq:t,void 0===e?this.lengthInSamples:e)},K.prototype.toString=function(){return"SampleCollection(freq="+e.toString(this.freq)+", lengthInSamples="+e.toString(this.lengthInSamples)+")"},K.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.freq)|0,t=31*t+e.hashCode(this.lengthInSamples)|0},K.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.freq,t.freq)&&e.equals(this.lengthInSamples,t.lengthInSamples)},R.prototype.setup=function(){},R.prototype.start=function(){this.samplesRecorded=0,this.state=W()},R.prototype.stop=function(){this.state=V()},Object.defineProperty(R.prototype,"state",{get:function(){return this.state_j0gsl6$_0},set:function(t){this.state_j0gsl6$_0=t}}),R.prototype.step_zgkg49$=function(t,n){var o=audioAnalyzer.updatePitch(t);pm_log("Timestamp: "+e.toString(t)),pm_log("Pitch: "+e.toString(o));var i=Ct/2;this.stepWithFrequency_88ee24$(t,o,i,this.latencyTime)},R.prototype.stepWithFrequency_88ee24$=function(t,n,o,i){var r=t-o/44100*1e3-i-this.lengthOfPrerollToIgnore;pm_log("Timestamp accounting for preroll "+r);var a=o-this.samplesRecorded+44.1*r;a<0?pm_log("Not filling yet..."):(pm_log("Filling "+e.toString(a)+" with "+n),this.samples.add_11rb$(new K(n,0|a)),this.samplesRecorded=this.samplesRecorded+(0|a)|0)},R.$metadata$={kind:e.Kind.CLASS,simpleName:"PitchTracker",interfaces:[H]};var zt,Lt;U.$metadata$={kind:e.Kind.CLASS,simpleName:"TimeKeeperState",interfaces:[_t]},U.values=function(){return[V(),W()]},U.valueOf_61zpoe$=function(t){switch(t){case"Stopped":return V();case"Running":return W();default:e.throwISE("No enum constant com.practicingmusician.steppable.TimeKeeper.TimeKeeperState."+t)}},Object.defineProperty(D.prototype,"state",{get:function(){return this.state_k2u27h$_0},set:function(t){if(this.state_k2u27h$_0=t,t===V()){var e;for(e=this.finishedActions.iterator();e.hasNext();)e.next()()}}}),D.prototype.start=function(){this.state=W(),this.requestNextStep()},D.prototype.stop=function(){this.state=V(),this.timeOffSet=-1},D.prototype.requestNextStep=function(){window.requestAnimationFrame(G(this))},D.prototype.step_14dthe$=function(t){-1===this.timeOffSet&&(this.timeOffSet=t);var n=t-this.timeOffSet;pm_log("Calling step at : "+e.toString(n)+" (raw: "+t+")");var o;for(o=this.steppables.iterator();o.hasNext();){var i=o.next();i.state===W()&&i.step_zgkg49$(n,this)}var r;for(r=this.analyzers.iterator();r.hasNext();)r.next().analyze_14dthe$(n);n>=this.runForTime&&(pm_log("STOPPED ((((((((((((((((((((((((((((((())))))))))))))))))",9),this.state=V()),this.state!==V()&&this.requestNextStep()},D.prototype.currentTime=function(){return window.performance.now()-this.timeOffSet},D.$metadata$={kind:e.Kind.CLASS,simpleName:"TimeKeeper",interfaces:[]},H.$metadata$={kind:e.Kind.INTERFACE,simpleName:"TimeKeeperSteppable",interfaces:[]},X.$metadata$={kind:e.Kind.INTERFACE,simpleName:"TimeKeeperAnalyzer",interfaces:[]},Y.prototype.runTest=function(){var t,n=new R;for(t=wt(new $t(24,1024),17).iterator();t.hasNext();)t.next();pt("Samples: "+e.toString(n.samples.size))},Y.prototype.toggleTest=function(){},Y.$metadata$={kind:e.Kind.OBJECT,simpleName:"PitchTrackerTest",interfaces:[]};var Ot=null;Q.$metadata$={kind:e.Kind.CLASS,simpleName:"PitchTrackerTestClass",interfaces:[]},Z.prototype.testShouldBe_3xie8k$=function(t,e){t.attempted===e.attempted&&t.correct===e.correct?pt("---- PASSED -----"):(window.alert("Failed"),pt("----- ***** FAILED ****** -----"))},Z.prototype.pitchTrackerTest=function(){var t;pt("***** Pitch tracker test");var n,o=new R,i=et().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo);for(o.lengthOfPrerollToIgnore=4*this.secondsPerBeat*1e3,pt("Sending preroll"),o.stepWithFrequency_88ee24$(o.lengthOfPrerollToIgnore,1,44.1*o.lengthOfPrerollToIgnore,0),n=o.lengthOfPrerollToIgnore,pt("------"),t=i.iterator();t.hasNext();){var r=t.next();n+=r.lengthInSamples/44100*1e3,pt("sending "+e.toString(r.lengthInSamples)+" at "+n),o.stepWithFrequency_88ee24$(n,r.freq,r.lengthInSamples,0),pt("--------")}var a,s=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(i,10));for(a=i.iterator();a.hasNext();){var l=a.next();s.add_11rb$(l.lengthInSamples)}var c=s.iterator();if(!c.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var p=c.next();c.hasNext();)p=p+c.next()|0;var u,m=p,h=o.samples,d=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(h,10));for(u=h.iterator();u.hasNext();){var f=u.next();d.add_11rb$(f.lengthInSamples)}var g=d.iterator();if(!g.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var _=g.next();g.hasNext();)_=_+g.next()|0;pt("Sample lengths :  "+m+" | "+_);var v=o.samples,y=new S;y.tempo=this.tempo;var $=y.convertSamplesBufferToNotes_mtnj1d$(v),b=et().addAvgPitchToSamples_j4do5z$($);pt("Comparing exact copies (incremental)...");var N=new w;N.correct=4,N.attempted=4;var x=new k;this.testShouldBe_3xie8k$(N,x.compareNoteArrays_11i8u3$(this.notes,b))},Z.prototype.trueIncrementalBufferAndComparisonTest=function(){},Z.prototype.trueIncrementalBufferTest=function(){var t=new S;t.tempo=this.tempo;var n=et().generateExactBufferCollectionWithSize1FromNotes_jisecs$(this.notes,this.tempo);console.log("Starting with "+e.toString(n.size));for(var o=e.kotlin.collections.ArrayList_init_ww73n8$(),i=0;;){var r=i+700|0;r>=n.size&&(r=n.size);var a=n.subList_vux9f0$(i,r);o.addAll_brywnq$(a);var s=t.convertSamplesBufferToNotes_mtnj1d$(o);if(i=i+700|0,r===n.size)break;console.log("Notes after slicing:"),console.log(s)}},Z.prototype.trueIncrementalComparisonTest=function(){var t;pt("****** Beginning true incremental test");var n=new S;n.tempo=this.tempo;var o=et().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),i=n.convertSamplesBufferToNotes_mtnj1d$(o),r=et().addAvgPitchToSamples_j4do5z$(i);pt("Comparing exact copies (incremental)...");var a=new k;t=r.size;for(var s=0;s<=t;s++){var l=r.subList_vux9f0$(0,s);console.log("Sublist:"+e.toString(l.size)),console.log(l),this.testShouldBe_3xie8k$.call(this,new w(l.size,l.size),a.compareNoteArrays_11i8u3$(this.notes,l))}},Z.prototype.exactIncrementalTestInBulk=function(){pt("****** Beginning incremental bulk test");var t=new S;t.tempo=this.tempo;var n=et().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),o=t.convertSamplesBufferToNotes_mtnj1d$(n),i=et().addAvgPitchToSamples_j4do5z$(o);pt("Comparing exact copies (incremental)...");var r=new w;r.correct=4,r.attempted=4;var a,s=new k,l=this.testShouldBe_3xie8k$,c=y(),p=this.notes,u=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(i,10));for(a=i.iterator();a.hasNext();){var m=a.next();u.add_11rb$(m.note)}l.call(this,r,c.compareNoteArrays_l4hzig$(p,u)),this.testShouldBe_3xie8k$(r,s.compareNoteArrays_11i8u3$(this.notes,i))},Z.prototype.sharpTest=function(){pt("****** Beginning sharp test");var t=new k,n=new S;n.tempo=this.tempo;var o=et().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),i=n.convertSamplesBufferToNotes_mtnj1d$(o),r=i.get_za3lpa$(1).note.getFrequency(),a=j().getFrequencyForNoteNumber_za3lpa$(i.get_za3lpa$(1).note.noteNumber+1|0),s=a-r,l=s*((t.allowableCentsMargin+1)/100);pt("Original freq: "+e.toString(r)),pt("Next note up "+a+" distance "+s+" to move "+l),i.get_za3lpa$(3).note.avgFreq=r+l;var c=et().addAvgPitchToSamples_j4do5z$(i);pt("Comparing sharp copy...");var p=new w;p.correct=3,p.attempted=4,this.testShouldBe_3xie8k$(p,t.compareNoteArrays_11i8u3$(this.notes,c))},Z.prototype.flatTest=function(){pt("****** Beginning flat test");var t=new k,n=new S;n.tempo=this.tempo;var o=et().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),i=n.convertSamplesBufferToNotes_mtnj1d$(o),r=i.get_za3lpa$(1).note.getFrequency(),a=j().getFrequencyForNoteNumber_za3lpa$(i.get_za3lpa$(1).note.noteNumber-1|0),s=r-a,l=s*((t.allowableCentsMargin+1)/100);pt("Original freq: "+e.toString(r)),pt("Next note up "+a+" distance "+s+" to move "+l),i.get_za3lpa$(3).note.avgFreq=r-l;var c=et().addAvgPitchToSamples_j4do5z$(i);pt("Comparing flat copy...");var p=new w;p.correct=3,p.attempted=4,this.testShouldBe_3xie8k$(p,t.compareNoteArrays_11i8u3$(this.notes,c))},Z.prototype.rushedTest=function(){pt("****** Beginning rushed test");var t=new k,e=new S;e.tempo=this.tempo;var n=bt([new F(69,.5),new F(81,1-t.allowableRhythmMargin-.01),new F(69,1),new F(81,1)]),o=et().generateExactBufferCollectionFromNotes_jisecs$(n,this.tempo),i=e.convertSamplesBufferToNotes_mtnj1d$(o),r=et().addAvgPitchToSamples_j4do5z$(i),a=new w;a.correct=2,a.attempted=4,pt("Comparing rushed..."),this.testShouldBe_3xie8k$(a,t.compareNoteArrays_11i8u3$(this.notes,r))},Z.prototype.shortNotesTest=function(){pt("****** Beginning short notes test");var t=new k,e=new S;e.tempo=this.tempo;var n=bt([new F(69,.31),new F(35,.05),new F(69,.14),new F(81,.78),new F(34,.11),new F(35,.11),new F(69,1),new F(81,1)]),o=et().generateExactBufferCollectionFromNotes_jisecs$(n,this.tempo),i=e.convertSamplesBufferToNotes_mtnj1d$(o),r=et().addAvgPitchToSamples_j4do5z$(i),a=new w;a.correct=4,a.attempted=4,pt("Comparing short notes..."),this.testShouldBe_3xie8k$(a,t.compareNoteArrays_11i8u3$(this.notes,r))},Z.prototype.runTest=function(){return j().createAllNotes(),this.exactIncrementalTestInBulk(),this.rushedTest(),this.shortNotesTest(),this.pitchTrackerTest(),this.trueIncrementalComparisonTest(),this.sharpTest(),this.flatTest(),"Done"},Z.$metadata$={kind:e.Kind.OBJECT,simpleName:"SliceTest",interfaces:[]};var Bt=null;tt.prototype.generateExactBufferFromNotes_jisecs$=function(t,e){return _().convertNotesToSamples_jisecs$(t,e)},tt.prototype.generateExactBufferCollectionWithSize1FromNotes_jisecs$=function(t,n){var o,i=60/n,r=e.kotlin.collections.ArrayList_init_ww73n8$(),a=e.kotlin.collections.ArrayList_init_ww73n8$();for(o=t.iterator();o.hasNext();){var s,l,c,p,u=o.next();a.add_11rb$(r.size);var m=u.duration*i*_().sampleRate,h=u.getFrequency();l=(s=ot(0,0|m)).first,c=s.last,p=s.step;for(var d=l;d<=c;d+=p)r.add_11rb$(h)}console.log("Note change indexes: "+e.toString(a));var f,g=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(f=r.iterator();f.hasNext();){var v=f.next(),y=g.add_11rb$,$=new K(v,1);y.call(g,$)}return g},tt.prototype.generateExactBufferCollectionFromNotes_jisecs$=function(t,n){var o,i=60/n,r=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(o=t.iterator();o.hasNext();){var a=o.next(),s=r.add_11rb$,l=new K(a.getFrequency(),a.duration*i*_().sampleRate|0);s.call(r,l)}return r},tt.prototype.addAvgPitchToSamples_j4do5z$=function(t){var n,o=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(n=t.iterator();n.hasNext();){var i=n.next(),r=o.add_11rb$;null==i.note.avgFreq&&(i.note.avgFreq=i.note.getFrequency()),r.call(o,i)}return o},tt.prototype.addPitchVariationToSamples_d3e2cz$=function(t){var n,o=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(n=t.iterator();n.hasNext();){var i=n.next(),r=o.add_11rb$,a=15*Math.random()*2;r.call(o,i+a/2)}return o},tt.prototype.addRhythmVariationToSamples_d3e2cz$=function(t){for(var e=lt(t),n=0;n<=3600;n++)e.removeAt_za3lpa$(0);for(var o=14e3;o<=18e3;o++)e.add_11rb$(e.get_za3lpa$(400));for(var i=13e3;i<=15500;i++)e.removeAt_za3lpa$(0);return e},tt.prototype.addShortItemsThatShouldBeRemoved_d3e2cz$=function(t){for(var e=lt(t),n=0;n<=5;n++)e.add_wxm5ur$(0,2);for(var o=0;o<=15;o++)e.add_wxm5ur$(100,2);for(var i=0;i<=3;i++)e.add_wxm5ur$(1e4,2);return e},tt.$metadata$={kind:e.Kind.OBJECT,simpleName:"TestBufferGenerator",interfaces:[]};var Ft=null,qt=t.com||(t.com={}),jt=qt.practicingmusician||(qt.practicingmusician={});jt.ListenerApp=n,jt.AudioAnalyzer=o,jt.GeneratedExercise=i,jt.EasyScoreCode=r,jt.SimpleJSNoteObject=a,jt.BeatPosition=s,Object.defineProperty(jt,"UserSettings",{get:c}),(jt.audio||(jt.audio={})).AudioManager=p;var Pt=jt.exercises||(jt.exercises={});Pt.ExerciseDefinition=h,Pt.ExerciseManager=d;var Mt=jt.finals||(jt.finals={});Object.defineProperty(Mt,"BufferManager",{get:_}),Object.defineProperty(Mt,"CompareEngine",{get:y}),Mt.FeedbackItem=$,Mt.CompareResults=w,Mt.NotePlacement=b,Mt.IncrementalBufferManager=S,Mt.IncrementalComparisonEngine=k,Object.defineProperty(x,"NoteChange",{get:A}),Object.defineProperty(x,"BeatChange",{get:E}),N.MarkerType=x,(jt.models||(jt.models={})).Slice=N;var Kt=jt.network||(jt.network={});Kt.NetworkRequestTransportObject=I,Object.defineProperty(Kt,"ListenerNetworkManager",{get:z});var Rt=jt.notes||(jt.notes={});Rt.EasyScoreUtil_Kotlin=L,Rt.NotationItem=O,Rt.Barline=B,Object.defineProperty(F,"Companion",{get:j}),Rt.Note=F,Object.defineProperty(Rt,"ALL_NOTES",{get:function(){return It},set:function(t){It=t}});var Dt=jt.steppable||(jt.steppable={});Dt.Metronome=P,Object.defineProperty(Dt,"buflen",{get:function(){return Ct},set:function(t){Ct=t}}),Dt.SampleCollection=K,Dt.PitchTracker=R,Object.defineProperty(U,"Stopped",{get:V}),Object.defineProperty(U,"Running",{get:W}),D.TimeKeeperState=U,Dt.TimeKeeper=D,Dt.TimeKeeperSteppable=H,Dt.TimeKeeperAnalyzer=X;var Ut=jt.tests||(jt.tests={});return Object.defineProperty(Ut,"PitchTrackerTest",{get:function(){return null===Ot&&new Y,Ot}}),Ut.PitchTrackerTestClass=Q,Object.defineProperty(Ut,"SliceTest",{get:function(){return null===Bt&&new Z,Bt}}),Object.defineProperty(Ut,"TestBufferGenerator",{get:et}),t.main_kand9s$=nt,It=e.kotlin.collections.ArrayList_init_ww73n8$(),Ct=1024,nt(),e.defineModule("PracticingMusician",t),t}(void 0===PracticingMusician?{}:PracticingMusician,kotlin);