if("undefined"==typeof kotlin)throw new Error("Error loading module 'PracticingMusician'. Its dependency 'kotlin' was not found. Please, check whether 'kotlin' is loaded prior to 'PracticingMusician'.");var PracticingMusician=function(t,e){"use strict";function o(){this.globalTempo_qfs5dx$_0=120,this.scoreUtil=this.scoreUtil,this.generatedExercise=this.generatedExercise,this.parameters=this.parameters,this.audioManager=this.audioManager,this.exerciseManager=this.exerciseManager,this.tuner=this.tuner,this.currentFeedbackItems=e.kotlin.collections.ArrayList_init_ww73n8$()}function n(t){return!0}function i(t,e,o){this.imageType=t,this.title=e,this.message=o}function r(t,e){this.type=t,this.message=e}function a(t,e,o){this.testPitch=t,this.testRhythm=e,this.testDuration=o}function s(t,e,o,n){this.metronomeSound=t,this.bpm=e,this.transposition=o,this.pitch=n}function l(){}function c(){}function p(){}function u(){}function h(t,e){this.noteNumber=t,this.duration=e}function m(t,e){this.x=t,this.y=e}function d(){this.state_pxjm2z$_0=tt(),this.textElement=this.textElement,this.audioAnalyzer=this.audioAnalyzer,this.timekeeper=new Y,this.timekeeper.steppables.add_11rb$(this)}function f(){Ot=this,this.metronomeAudioOn_fgazsk$_0=!0,this.transposition=0,this.tempo=-1,this.pitch=440}function g(){return null===Ot&&new f,Ot}function y(){this.loadedAudio=e.kotlin.collections.LinkedHashMap_init_q3lmfv$(),this.timeoutKeys=e.kotlin.collections.ArrayList_init_ww73n8$()}function _(t,o){return function(){return pm_log("(( Playing..."+e.toString(t),6),null!=o&&(o.currentTime=0),null!=o?o.play():null}}function v(t){return!0}function $(){this.tempo=120,this.time_signature=4,this.count_off=8;var t=e.kotlin.collections.ArrayList_init_ww73n8$();this.notes=e.kotlin.collections.copyToArray(t)}function b(){this.documentInfo=e.kotlin.collections.LinkedHashMap_init_q3lmfv$(),this.output=""}function w(){this.notes=e.kotlin.collections.ArrayList_init_ww73n8$(),this.prerollLengthInBeats=4}function S(t){this.currentExercise=null,this.timeKeeper=new Y,this.metronome=new J,this.pitchTracker=new X,this.bufferManager=new L,this.comparisonEngine=new q,this.audioManager=t,pm_log("Init"),this.lastAnalysisTimestamp=gt.MIN_VALUE}function x(t){return function(){var e=t.correct/t.attempted;return e>.85?"medal-gold-icon":e>.7?"medal-silver-icon":e>.55?"medal-bronze-icon":""}}function A(t){return function(o){var n;t.audioManager.cancelAllAudio(),t.metronome.cancelAllUIUpdates();var r=t.pitchTracker.samples.size/44100;pm_log("Total samples recorded: "+e.toString(t.pitchTracker.samples.size)+" length: "+e.toString(r));var a=t.bufferManager.convertSamplesBufferToNotes_mtnj1d$(t.pitchTracker.samples);pm_log("Notes: ");var s;for(s=a.iterator();s.hasNext();){var l=s.next();pm_log("Note: "+e.toString(l.note.noteNumber)+" for "+e.toString(l.note.duration)+" at "+e.toString(l.positionInBeats))}if(null!=(n=t.currentExercise)){var c=t;pm_log("Comparing...");var p=c.comparisonEngine.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,n.notes,a);listenerApp.clearFeedbackItems();var u;for(u=p.feedbackItems.iterator();u.hasNext();){var h=u.next();listenerApp.addFeedbackItem_775p9r$(h)}var m=x(p)();displaySiteDialog(new i(m,"Results","Overall accuracy: "+e.toString(p.correct)+"/"+e.toString(p.attempted))),M().buildAndSendRequest_fhpv3e$(p)}}}function k(t,e){this.name=t,this.value=e}function N(t,e){$t.call(this),this.name$=t,this.ordinal$=e}function T(){T=function(){},Et=new N("Correct",0),zt=new N("Incorrect",1),Dt=new N("Missed",2)}function C(){return T(),Et}function P(){return T(),zt}function j(){return T(),Dt}function I(t,e,o){this.type=t,this.beat=e,this.feedbackItemType=o}function O(t){t.type!==j()&&(t.type=P())}function E(t,o){void 0===t&&(t=0),void 0===o&&(o=0),this.c=t,this.a=o,this.correct=this.c,this.attempted=this.a,this.feedbackItems=e.kotlin.collections.ArrayList_init_ww73n8$(),this.finalResults=e.kotlin.collections.ArrayList_init_ww73n8$()}function z(t,e,o,n,i,r,a,s){void 0===t&&(t=-1),void 0===e&&(e=-1),this.userID=t,this.exerciseID=e,this.correct=o,this.attempted=n,this.exerciseAveragePitch=i,this.exerciseAverageRhythm=r,this.exerciseAverageDuration=a,this.notePerformances=s}function D(t,e,o,n,i,r){this.idealBeat=t,this.actualBeat=e,this.idealPitch=o,this.actualPitch=n,this.idealDuration=i,this.actualDuration=r}function F(t,e){this.note=t,this.positionInBeats=e}function L(){this.sampleRate=44100,this.minDurationInBeats=0}function q(){this.largestDurationRatioDifference=0,this.largestBeatDifference=0}function B(){Ft=this,this.mapTest=Nt([kt("test",1),kt("test2",4)])}function M(){return null===Ft&&new B,Ft}function R(t){this.performance=t}function K(){this.scorePositionInitialX=60,this.scorePositionInitialY=20,this.scorePositionX=0,this.scorePositionY=0,this.positionInLine=0,this.scorePositionCurrentLine=0,this.measureCounter=0,this.exercise=null,this.generatedExercise=this.generatedExercise,this.vf=null,this.registry=null,this.score=null,this.voice=null,this.beam=null,this.contentScaleFactor=1,this.useScaling=!0,this.assumedCanvasWidth=1024,this.barWidth=200,this.barHeight=160,this.firstBarAddition=40,this.barsPerLine=4,this.noteIDNumber=0,this.systems=e.kotlin.collections.ArrayList_init_ww73n8$()}function U(t,e,o){H(),void 0===o&&(o="none"),this.noteNumber=t,this.duration=e,this.textValue=o,this.avgFreq=null}function W(){Lt=this}function H(){return null===Lt&&new W,Lt}function J(){this.downbeatAudioKey="downbeatSound",this.beatAudioKey="beatSound",this.audioManager=this.audioManager,this.state_t08vao$_0=tt(),this.timeSignature=4,this.prerollBeats=4,this.currentBeat=0,this.beatTimes=e.kotlin.collections.ArrayList_init_ww73n8$(),this.lastBeatOccuredAt=-1,this.timeoutKeys=e.kotlin.collections.ArrayList_init_ww73n8$()}function G(t){return!0}function V(t,e,o){this.freq=t,this.lengthInSamples=e,this.timestampInSamples=o}function X(){this.sampleRate=44100,this.lengthOfPrerollToIgnore=0,this.latencyTime=180,this.samples=e.kotlin.collections.ArrayList_init_ww73n8$(),this.samplesRecorded=0,this.state_j0gsl6$_0=tt()}function Y(){this.finishedActions=e.kotlin.collections.ArrayList_init_ww73n8$(),this.state_k2u27h$_0=tt(),this.steppables=e.kotlin.collections.ArrayList_init_ww73n8$(),this.analyzers=e.kotlin.collections.ArrayList_init_ww73n8$(),this.timeOffSet=-1,this.runForTime=4100}function Q(t,e){$t.call(this),this.name$=t,this.ordinal$=e}function Z(){Z=function(){},Mt=new Q("Stopped",0),Rt=new Q("Running",1),Kt=new Q("Completed",2)}function tt(){return Z(),Mt}function et(){return Z(),Rt}function ot(){return Z(),Kt}function nt(t){return function(e){t.step_14dthe$(e)}}function it(){}function rt(){}function at(){Ut=this}function st(){this.tracker=new X}function lt(){this.notationContainerName_7mvjxd$_0="notationBody",this.metronomeContainerName_7mvjxd$_0="metronomeContainer",this.userID_7mvjxd$_0=1,this.exerciseID_7mvjxd$_0=2,this.databaseEndpoint_7mvjxd$_0="",this.url_7mvjxd$_0="",this.audioAssetPath_7mvjxd$_0="",this.allowableCentsMargin_7mvjxd$_0=40,this.allowableRhythmMargin_7mvjxd$_0=.25,this.allowableDurationRatio_7mvjxd$_0=.5,this.minDurationInBeats_7mvjxd$_0=.24,this.largestDurationRatioDifference_7mvjxd$_0=.5,this.largestBeatDifference_7mvjxd$_0=1,this.comparisonFlags_7mvjxd$_0=new a(!0,!0,!0),this.bpm_7mvjxd$_0=120,this.metronomeSound_7mvjxd$_0=!0,this.pitch_7mvjxd$_0=440,this.transposition_7mvjxd$_0=0}function ct(){Wt=this,this.notes=It([new U(69,.5),new U(81,1),new U(69,1),new U(81,1)]),this.tempo=120,this.secondsPerBeat=60/this.tempo,this.sampleRate=44100,this.bufferLengthInSamples=1024}function pt(){Ht=this}function ut(){return null===Ht&&new pt,Ht}function ht(t){}var mt=e.kotlin.collections.toList_7wnvza$,dt=e.kotlin.ranges.until_dqglrj$,ft=e.kotlin.collections.removeAll_qafx1e$,gt=e.kotlin.js.internal.DoubleCompanionObject,yt=e.kotlin.collections.toList_us0mfu$,_t=e.kotlin.collections.reversed_7wnvza$,vt=e.kotlin.collections.toMutableList_4c7yge$,$t=e.kotlin.Enum,bt=e.kotlin.collections.average_l63kqw$,wt=e.kotlin.collections.zip_45mdf7$,St=e.kotlin.js.internal.IntCompanionObject,xt=e.kotlin.Pair,At=e.kotlin.collections.last_2p1efm$,kt=e.kotlin.to_ujzrz7$,Nt=e.kotlin.collections.mapOf_qfcya0$,Tt=e.kotlin.collections.get_indices_gzk92b$,Ct=e.kotlin.ranges.IntRange,Pt=e.kotlin.ranges.step_xsgg7u$,jt=e.kotlin.io.println_s8jyv4$,It=e.kotlin.collections.listOf_i5x0yv$;N.prototype=Object.create($t.prototype),N.prototype.constructor=N,Q.prototype=Object.create($t.prototype),Q.prototype.constructor=Q,Object.defineProperty(o.prototype,"globalTempo",{get:function(){return this.globalTempo_qfs5dx$_0},set:function(t){this.globalTempo_qfs5dx$_0=t}}),o.prototype.setTempoForTests_14dthe$=function(t){this.globalTempo=t},o.prototype.runTuner=function(t){H().createAllNotes(),audioAnalyzer.setupMedia();var e=this.makeTunerDomElements();this.tuner=new d,this.tuner.textElement=e,this.tuner.audioAnalyzer=audioAnalyzer,this.tuner.run()},o.prototype.runApp=function(t){this.audioManager=new y,this.exerciseManager=new S(this.audioManager),this.scoreUtil=new EasyScoreUtil,this.parameters=t,H().createAllNotes(),audioAnalyzer.setupMedia();var e=new s(t.metronomeSound,t.bpm,t.transposition,t.pitch);this.alterPreferences(e),this.generatedExercise=generateExerciseForKotlin(),this.generatedExercise=g().applyToExercise_k94nyn$(this.generatedExercise),this.globalTempo=this.generatedExercise.tempo,this.exerciseManager.loadExercise(),this.makeDomElements()},o.prototype.alterPreferences=function(t){var e,o,n,i;this.exerciseManager.stop(),null!=(e=t.metronomeSound)&&(g().metronomeAudioOn=e),null!=(o=t.bpm)&&(console.log("Setting bpm to "+o),this.globalTempo=o,this.scoreUtil.setupMetronome(this.parameters.metronomeContainerName)),null!=(n=t.pitch)&&(g().pitch=n),null!=(i=t.transposition)&&(g().transposition=i,this.generatedExercise=g().applyToExercise_k94nyn$(this.generatedExercise))},o.prototype.makeTunerDomElements=function(){var t;return e.isType(t=document.getElementById("tunerWindow"),HTMLElement)?t:e.throwCCE()},o.prototype.makeDomElements=function(){var t,o,n,i,r,a;pm_log("Making window w/ container: "+this.parameters.notationContainerName,10);var s=e.isType(t=document.getElementById(this.parameters.notationContainerName),HTMLElement)?t:e.throwCCE();s.className=s.className+"notationBodyContainer";var l=e.isType(o=document.createElement("canvas"),HTMLElement)?o:e.throwCCE();l.style.position="absolute",l.id="indicatorCanvas",null!=(n=document.getElementById(this.parameters.notationContainerName))&&n.appendChild(l),pm_log("Made indicator canvas on notation body: ",10),pm_log(e.isType(i=document.getElementById(this.parameters.notationContainerName),HTMLElement)?i:e.throwCCE());var c=e.isType(r=document.createElement("canvas"),HTMLElement)?r:e.throwCCE();c.style.position="absolute",c.id="feedbackCanvas",null!=(a=document.getElementById(this.parameters.notationContainerName))&&a.appendChild(c),this.makeScore_61zpoe$(this.parameters.notationContainerName)},o.prototype.makeScore_61zpoe$=function(t){this.scoreUtil=new EasyScoreUtil,this.scoreUtil.containerElementName=this.parameters.notationContainerName;var e=generateExerciseEasyScoreCode();this.scoreUtil.exercise=e,this.scoreUtil.generatedExercise=this.generatedExercise,pm_log("Setting up score on "+t),this.scoreUtil.setupOnElement(t),this.scoreUtil.setupMetronome(this.parameters.metronomeContainerName),this.scoreUtil.buildTitleElements(t),this.scoreUtil.notateExercise()},o.prototype.toggleState=function(){var t;if(t=this.exerciseManager.timeKeeper.state,e.equals(t,tt())){if(!audioAnalyzer.isFunctional||!audioAnalyzer.hasMicrophoneAccess)return void displayFlashMessages([new r("danger","Audio not working.  Please make sure you are using either Chrome or Firefox and have enabled microphone access.")]);this.exerciseManager.createSteppables(),this.exerciseManager.setup(),this.exerciseManager.loadExercise(),this.exerciseManager.run()}else e.equals(t,et())?this.exerciseManager.stop():e.equals(t,ot())},o.prototype.doResizeActions=function(){var t,o;pm_log("Resized window w/ container: "+this.parameters.notationContainerName,10);var n=e.isType(t=document.getElementsByTagName("svg")[0],Element)?t:e.throwCCE();null!=(o=n.parentNode)&&o.removeChild(n),listenerApp.makeScore_61zpoe$(this.parameters.notationContainerName);var i=mt(listenerApp.currentFeedbackItems);listenerApp.clearFeedbackItems();var r;for(r=i.iterator();r.hasNext();){var a=r.next();listenerApp.addFeedbackItem_775p9r$(a)}},o.prototype.moveToPosition_14dthe$=function(t){var o,n=e.isType(o=document.getElementById("indicatorCanvas"),HTMLCanvasElement)?o:null;(null!=n?n.getContext("2d"):null).clearRect(0,0,null!=n?n.width:null,null!=n?n.height:null),this.scoreUtil.drawIndicatorLine(n,t)},o.prototype.highlightMetronomeItem_za3lpa$=function(t){var o,n,i,r,a,s=document.getElementsByClassName("metronomeItem");n=(o=dt(0,s.length)).first,i=o.last,r=o.step;for(var l=n;l<=i;l+=r){var c=e.isType(a=s[l],HTMLElement)?a:e.throwCCE();c.className="metronomeItem",t===l&&(c.className=c.className+" highlighted")}},o.prototype.clearFeedbackItems=function(){var t;ft(this.currentFeedbackItems,n),pm_log("Clearing");for(var o=document.getElementsByClassName("feedbackItem");o.length>0;){var i,r=e.isType(t=o[0],HTMLElement)?t:e.throwCCE();null!=(i=r.parentNode)&&i.removeChild(r)}},o.prototype.addFeedbackItem_775p9r$=function(t){-1===this.currentFeedbackItems.indexOf_11rb$(t)&&this.currentFeedbackItems.add_11rb$(t);var o=this.scoreUtil.getPositionForBeat(t.beat),n=this.scoreUtil.getFeedbackYPosition(o.y),i=this.scoreUtil,r=t.type,a=t.feedbackItemType;i.createFeedbackHTMLElement(r,e.kotlin.collections.copyToArray(a),o.x,n)},o.$metadata$={kind:e.Kind.CLASS,simpleName:"ListenerApp",interfaces:[]},i.$metadata$={kind:e.Kind.CLASS,simpleName:"DialogParams",interfaces:[]},i.prototype.component1=function(){return this.imageType},i.prototype.component2=function(){return this.title},i.prototype.component3=function(){return this.message},i.prototype.copy_6hosri$=function(t,e,o){return new i(void 0===t?this.imageType:t,void 0===e?this.title:e,void 0===o?this.message:o)},i.prototype.toString=function(){return"DialogParams(imageType="+e.toString(this.imageType)+", title="+e.toString(this.title)+", message="+e.toString(this.message)+")"},i.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.imageType)|0,t=31*t+e.hashCode(this.title)|0,t=31*t+e.hashCode(this.message)|0},i.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.imageType,t.imageType)&&e.equals(this.title,t.title)&&e.equals(this.message,t.message)},r.$metadata$={kind:e.Kind.CLASS,simpleName:"FlashMessage",interfaces:[]},r.prototype.component1=function(){return this.type},r.prototype.component2=function(){return this.message},r.prototype.copy_puj7f4$=function(t,e){return new r(void 0===t?this.type:t,void 0===e?this.message:e)},r.prototype.toString=function(){return"FlashMessage(type="+e.toString(this.type)+", message="+e.toString(this.message)+")"},r.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.type)|0,t=31*t+e.hashCode(this.message)|0},r.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.type,t.type)&&e.equals(this.message,t.message)},a.$metadata$={kind:e.Kind.CLASS,simpleName:"ComparisonFlags",interfaces:[]},a.prototype.component1=function(){return this.testPitch},a.prototype.component2=function(){return this.testRhythm},a.prototype.component3=function(){return this.testDuration},a.prototype.copy_ws0pad$=function(t,e,o){return new a(void 0===t?this.testPitch:t,void 0===e?this.testRhythm:e,void 0===o?this.testDuration:o)},a.prototype.toString=function(){return"ComparisonFlags(testPitch="+e.toString(this.testPitch)+", testRhythm="+e.toString(this.testRhythm)+", testDuration="+e.toString(this.testDuration)+")"},a.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.testPitch)|0,t=31*t+e.hashCode(this.testRhythm)|0,t=31*t+e.hashCode(this.testDuration)|0},a.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.testPitch,t.testPitch)&&e.equals(this.testRhythm,t.testRhythm)&&e.equals(this.testDuration,t.testDuration)},s.$metadata$={kind:e.Kind.CLASS,simpleName:"AppPreferences",interfaces:[]},s.prototype.component1=function(){return this.metronomeSound},s.prototype.component2=function(){return this.bpm},s.prototype.component3=function(){return this.transposition},s.prototype.component4=function(){return this.pitch},s.prototype.copy_ho9xxj$=function(t,e,o,n){return new s(void 0===t?this.metronomeSound:t,void 0===e?this.bpm:e,void 0===o?this.transposition:o,void 0===n?this.pitch:n)},s.prototype.toString=function(){return"AppPreferences(metronomeSound="+e.toString(this.metronomeSound)+", bpm="+e.toString(this.bpm)+", transposition="+e.toString(this.transposition)+", pitch="+e.toString(this.pitch)+")"},s.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.metronomeSound)|0,t=31*t+e.hashCode(this.bpm)|0,t=31*t+e.hashCode(this.transposition)|0,t=31*t+e.hashCode(this.pitch)|0},s.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.metronomeSound,t.metronomeSound)&&e.equals(this.bpm,t.bpm)&&e.equals(this.transposition,t.transposition)&&e.equals(this.pitch,t.pitch)},l.$metadata$={kind:e.Kind.INTERFACE,simpleName:"AppSetupParameters",interfaces:[]},c.$metadata$={kind:e.Kind.INTERFACE,simpleName:"AudioAnalyzer",interfaces:[]},p.$metadata$={kind:e.Kind.INTERFACE,simpleName:"GeneratedExercise",interfaces:[]},u.$metadata$={kind:e.Kind.INTERFACE,simpleName:"EasyScoreCode",interfaces:[]},h.$metadata$={kind:e.Kind.CLASS,simpleName:"SimpleJSNoteObject",interfaces:[]},h.prototype.component1=function(){return this.noteNumber},h.prototype.component2=function(){return this.duration},h.prototype.copy_5wr77w$=function(t,e){return new h(void 0===t?this.noteNumber:t,void 0===e?this.duration:e)},h.prototype.toString=function(){return"SimpleJSNoteObject(noteNumber="+e.toString(this.noteNumber)+", duration="+e.toString(this.duration)+")"},h.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.noteNumber)|0,t=31*t+e.hashCode(this.duration)|0},h.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.noteNumber,t.noteNumber)&&e.equals(this.duration,t.duration)},m.$metadata$={kind:e.Kind.CLASS,simpleName:"BeatPosition",interfaces:[]},m.prototype.component1=function(){return this.x},m.prototype.component2=function(){return this.y},m.prototype.copy_lu1900$=function(t,e){return new m(void 0===t?this.x:t,void 0===e?this.y:e)},m.prototype.toString=function(){return"BeatPosition(x="+e.toString(this.x)+", y="+e.toString(this.y)+")"},m.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.x)|0,t=31*t+e.hashCode(this.y)|0},m.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.x,t.x)&&e.equals(this.y,t.y)},Object.defineProperty(d.prototype,"state",{get:function(){return this.state_pxjm2z$_0},set:function(t){this.state_pxjm2z$_0=t}}),d.prototype.setup=function(){},d.prototype.start=function(){this.state=et()},d.prototype.stop=function(){this.state=tt()},d.prototype.step_zgkg49$=function(t,o){var n=this.audioAnalyzer.updatePitch(t);if(!e.equals(n,void 0)){var i=H().closestNoteToFrequency_14dthe$(n);this.textElement.innerText=i.toString()+" : "+n}},d.prototype.run=function(){this.start(),this.timekeeper.runForTime=gt.MAX_VALUE,this.timekeeper.start()},d.$metadata$={kind:e.Kind.CLASS,simpleName:"PMTuner",interfaces:[it]},Object.defineProperty(f.prototype,"metronomeAudioOn",{get:function(){return this.metronomeAudioOn_fgazsk$_0},set:function(t){pm_log("Metronome audio value changed",10),this.metronomeAudioOn_fgazsk$_0=t}}),f.prototype.applyToExercise_k94nyn$=function(t){var o,n=yt(t.notes),i=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(n,10));for(o=n.iterator();o.hasNext();){var r,a=o.next(),s=i.add_11rb$;t:do{if(0!==g().transposition){r=new h(a.noteNumber+g().transposition|0,a.duration);break t}r=a}while(!1);s.call(i,r)}return t.notes=e.kotlin.collections.copyToArray(i),-1!==this.tempo&&(t.tempo=this.tempo),t},f.$metadata$={kind:e.Kind.OBJECT,simpleName:"UserSettings",interfaces:[]};var Ot=null;y.prototype.loadAudioFile_puj7f4$=function(t,e){var o=new Audio(t);return this.loadedAudio.put_xwzc9p$(e,o),o},y.prototype.playAudioNow_61zpoe$=function(t){pm_log("**** (( Playing...",6);var e=this.loadedAudio.get_11rb$(t);null!=e&&(e.currentTime=0),null!=e&&e.play()},y.prototype.playAudio_bm4lxs$=function(t,e){var o=this.loadedAudio.get_11rb$(t),n=window.setTimeout(_(e,o),e);this.timeoutKeys.add_11rb$(n)},y.prototype.cancelAllAudio=function(){var t;for(t=_t(this.timeoutKeys).iterator();t.hasNext();){var e=t.next();pm_log("Cancelling item... "+e),window.clearTimeout(e)}ft(this.timeoutKeys,v)},y.$metadata$={kind:e.Kind.CLASS,simpleName:"AudioManager",interfaces:[]},$.$metadata$={kind:e.Kind.CLASS,simpleName:"GeneratedExerciseInfo",interfaces:[]},b.prototype.convertJSON=function(t){console.log("Going to convert json object:"),console.log(t),this.writeBoilerplate();var o=t.scorepartwise.work.worktitle;console.log("title: "+o);var n=t.scorepartwise.part;this.convertPart_za3rmp$(n);var i=new $,r=this.getNotesFromPart_za3rmp$(n);return i.notes=e.kotlin.collections.copyToArray(r),this.writeKotlinFunction_61zpoe$(JSON.stringify(i)),this.output},b.prototype.getNotesFromPart_za3rmp$=function(t){var o,n,i=e.kotlin.collections.ArrayList_init_ww73n8$(),r=Array.isArray(o=t.measure)?o:e.throwCCE();for(n=0;n!==r.length;++n){var a,s,l=r[n],c=Array.isArray(a=l.note)?a:e.throwCCE();for(s=0;s!==c.length;++s){c[s];var p=new h(60,1);i.add_11rb$(p)}}return i},b.prototype.convertPart_za3rmp$=function(t){},b.prototype.writeKotlinFunction_61zpoe$=function(t){this.output+="function generateExerciseForKotlin() {\n",this.output+="return ",this.output+=t,this.output+="}\n\n"},b.prototype.writeBoilerplate=function(){this.output+="var noteNumbers = { C4: 60, D4: 62, E4: 64, F4: 65, G4: 67, A4: 69, B4: 71, C5: 72 }\n\n var durations = {q: 1.0,h: 2.0,w: 4.0 }\n\n\n"},b.$metadata$={kind:e.Kind.CLASS,simpleName:"MusicXMLConverter",interfaces:[]},w.prototype.getLength=function(){var t,o=6e4/listenerApp.globalTempo,n=this.notes,i=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(n,10));for(t=n.iterator();t.hasNext();){var r=t.next();i.add_11rb$(r.duration)}var a=i.iterator();if(!a.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var s=a.next();a.hasNext();){var l=s;s=a.next()+l}return s*o},w.prototype.prerollLength=function(){return 6e4/listenerApp.globalTempo*this.prerollLengthInBeats},w.$metadata$={kind:e.Kind.CLASS,simpleName:"ExerciseDefinition",interfaces:[]},S.prototype.createSteppables=function(){this.timeKeeper=new Y,this.metronome=new J,this.pitchTracker=new X,this.bufferManager=new L,this.comparisonEngine=new q,this.lastAnalysisTimestamp=gt.MIN_VALUE},S.prototype.setup=function(){pm_log("Setup"),listenerApp.clearFeedbackItems(),this.metronome.audioManager=this.audioManager,this.timeKeeper.steppables.add_11rb$(this.metronome),this.timeKeeper.steppables.add_11rb$(this.pitchTracker),this.timeKeeper.analyzers.add_11rb$(this),this.timeKeeper.finishedActions.add_11rb$(A(this)),this.metronome.setup(),this.pitchTracker.setup()},S.prototype.run=function(){this.metronome.start(),this.pitchTracker.start(),this.timeKeeper.start()},S.prototype.stop=function(){this.timeKeeper.stop(),this.metronome.stop(),this.pitchTracker.stop()},S.prototype.loadExercise=function(){var t;pm_log("Loading exericse:");var o=listenerApp.generatedExercise,n=new w;n.prerollLengthInBeats=o.count_off;var i,r=o.notes,a=e.kotlin.collections.ArrayList_init_ww73n8$(r.length);for(i=0;i!==r.length;++i){var s=r[i];a.add_11rb$(new U(s.noteNumber,s.duration))}n.notes=vt(a),pm_log("Loaded "+e.toString(n.notes.size)+" notes"),pm_log(n.notes),this.currentExercise=n,null!=(t=this.currentExercise)&&(console.log("Testing time sig:"),console.log(o),this.metronome.timeSignature=o.time_signature,this.metronome.prerollBeats=o.count_off,this.timeKeeper.runForTime=t.getLength()+t.prerollLength()+this.pitchTracker.latencyTime,this.pitchTracker.lengthOfPrerollToIgnore=t.prerollLength(),pm_log("Loaded exercise of length "+e.toString(this.timeKeeper.runForTime)))},S.prototype.analyze_14dthe$=function(t){var o;if(t-this.lastAnalysisTimestamp>200&&(this.lastAnalysisTimestamp=t,null!=(o=this.currentExercise))){pm_log("Samples length: "+e.toString(this.pitchTracker.samples.size));var n=this.bufferManager.convertSamplesBufferToNotes_mtnj1d$(this.pitchTracker.samples),i=this.comparisonEngine.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,o.notes,n,!0);listenerApp.clearFeedbackItems();var r;for(r=i.feedbackItems.iterator();r.hasNext();){var a=r.next();listenerApp.addFeedbackItem_775p9r$(a)}}},S.$metadata$={kind:e.Kind.CLASS,simpleName:"ExerciseManager",interfaces:[rt]},k.$metadata$={kind:e.Kind.CLASS,simpleName:"FeedbackMetric",interfaces:[]},k.prototype.component1=function(){return this.name},k.prototype.component2=function(){return this.value},k.prototype.copy_puj7f4$=function(t,e){return new k(void 0===t?this.name:t,void 0===e?this.value:e)},k.prototype.toString=function(){return"FeedbackMetric(name="+e.toString(this.name)+", value="+e.toString(this.value)+")"},k.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.name)|0,t=31*t+e.hashCode(this.value)|0},k.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.name,t.name)&&e.equals(this.value,t.value)};var Et,zt,Dt;N.$metadata$={kind:e.Kind.CLASS,simpleName:"FeedbackType",interfaces:[$t]},N.values=function(){return[C(),P(),j()]},N.valueOf_61zpoe$=function(t){switch(t){case"Correct":return C();case"Incorrect":return P();case"Missed":return j();default:e.throwISE("No enum constant com.practicingmusician.finals.FeedbackType."+t)}},I.$metadata$={kind:e.Kind.CLASS,simpleName:"FeedbackItem",interfaces:[]},I.prototype.component1=function(){return this.type},I.prototype.component2=function(){return this.beat},I.prototype.component3=function(){return this.feedbackItemType},I.prototype.copy_4nfbc1$=function(t,e,o){return new I(void 0===t?this.type:t,void 0===e?this.beat:e,void 0===o?this.feedbackItemType:o)},I.prototype.toString=function(){return"FeedbackItem(type="+e.toString(this.type)+", beat="+e.toString(this.beat)+", feedbackItemType="+e.toString(this.feedbackItemType)+")"},I.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.type)|0,t=31*t+e.hashCode(this.beat)|0,t=31*t+e.hashCode(this.feedbackItemType)|0},I.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.type,t.type)&&e.equals(this.beat,t.beat)&&e.equals(this.feedbackItemType,t.feedbackItemType)},E.prototype.generateResultForDatabase=function(){var t,o=this.finalResults,n=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10));for(t=o.iterator();t.hasNext();){var i=t.next();n.add_11rb$(i.idealPitch-i.actualPitch)}var r,a=bt(n),s=this.finalResults,l=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(s,10));for(r=s.iterator();r.hasNext();){var c=r.next();l.add_11rb$(c.idealBeat-c.actualBeat)}var p,u=bt(l),h=this.finalResults,m=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(h,10));for(p=h.iterator();p.hasNext();){var d=p.next();m.add_11rb$(d.idealDuration-d.actualDuration)}var f=bt(m),g=this.correct,y=this.attempted,_=this.finalResults;return new z(void 0,void 0,g,y,a,u,f,e.kotlin.collections.copyToArray(_))},E.$metadata$={kind:e.Kind.CLASS,simpleName:"CompareResults",interfaces:[]},z.$metadata$={kind:e.Kind.CLASS,simpleName:"ResultsForDatabase",interfaces:[]},z.prototype.component1=function(){return this.userID},z.prototype.component2=function(){return this.exerciseID},z.prototype.component3=function(){return this.correct},z.prototype.component4=function(){return this.attempted},z.prototype.component5=function(){return this.exerciseAveragePitch},z.prototype.component6=function(){return this.exerciseAverageRhythm},z.prototype.component7=function(){return this.exerciseAverageDuration},z.prototype.component8=function(){return this.notePerformances},z.prototype.copy_sixtfu$=function(t,e,o,n,i,r,a,s){return new z(void 0===t?this.userID:t,void 0===e?this.exerciseID:e,void 0===o?this.correct:o,void 0===n?this.attempted:n,void 0===i?this.exerciseAveragePitch:i,void 0===r?this.exerciseAverageRhythm:r,void 0===a?this.exerciseAverageDuration:a,void 0===s?this.notePerformances:s)},z.prototype.toString=function(){return"ResultsForDatabase(userID="+e.toString(this.userID)+", exerciseID="+e.toString(this.exerciseID)+", correct="+e.toString(this.correct)+", attempted="+e.toString(this.attempted)+", exerciseAveragePitch="+e.toString(this.exerciseAveragePitch)+", exerciseAverageRhythm="+e.toString(this.exerciseAverageRhythm)+", exerciseAverageDuration="+e.toString(this.exerciseAverageDuration)+", notePerformances="+e.toString(this.notePerformances)+")"},z.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.userID)|0,t=31*t+e.hashCode(this.exerciseID)|0,t=31*t+e.hashCode(this.correct)|0,t=31*t+e.hashCode(this.attempted)|0,t=31*t+e.hashCode(this.exerciseAveragePitch)|0,t=31*t+e.hashCode(this.exerciseAverageRhythm)|0,t=31*t+e.hashCode(this.exerciseAverageDuration)|0,t=31*t+e.hashCode(this.notePerformances)|0},z.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.userID,t.userID)&&e.equals(this.exerciseID,t.exerciseID)&&e.equals(this.correct,t.correct)&&e.equals(this.attempted,t.attempted)&&e.equals(this.exerciseAveragePitch,t.exerciseAveragePitch)&&e.equals(this.exerciseAverageRhythm,t.exerciseAverageRhythm)&&e.equals(this.exerciseAverageDuration,t.exerciseAverageDuration)&&e.equals(this.notePerformances,t.notePerformances)},D.$metadata$={kind:e.Kind.CLASS,simpleName:"IndividualNotePerformanceInfo",interfaces:[]},D.prototype.component1=function(){return this.idealBeat},D.prototype.component2=function(){return this.actualBeat},D.prototype.component3=function(){return this.idealPitch},D.prototype.component4=function(){return this.actualPitch},D.prototype.component5=function(){return this.idealDuration},D.prototype.component6=function(){return this.actualDuration},D.prototype.copy_15yvbs$=function(t,e,o,n,i,r){return new D(void 0===t?this.idealBeat:t,void 0===e?this.actualBeat:e,void 0===o?this.idealPitch:o,void 0===n?this.actualPitch:n,void 0===i?this.idealDuration:i,void 0===r?this.actualDuration:r)},D.prototype.toString=function(){return"IndividualNotePerformanceInfo(idealBeat="+e.toString(this.idealBeat)+", actualBeat="+e.toString(this.actualBeat)+", idealPitch="+e.toString(this.idealPitch)+", actualPitch="+e.toString(this.actualPitch)+", idealDuration="+e.toString(this.idealDuration)+", actualDuration="+e.toString(this.actualDuration)+")"},D.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.idealBeat)|0,t=31*t+e.hashCode(this.actualBeat)|0,t=31*t+e.hashCode(this.idealPitch)|0,t=31*t+e.hashCode(this.actualPitch)|0,t=31*t+e.hashCode(this.idealDuration)|0,t=31*t+e.hashCode(this.actualDuration)|0},D.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.idealBeat,t.idealBeat)&&e.equals(this.actualBeat,t.actualBeat)&&e.equals(this.idealPitch,t.idealPitch)&&e.equals(this.actualPitch,t.actualPitch)&&e.equals(this.idealDuration,t.idealDuration)&&e.equals(this.actualDuration,t.actualDuration)},F.$metadata$={kind:e.Kind.CLASS,simpleName:"NotePlacement",interfaces:[]},F.prototype.component1=function(){return this.note},F.prototype.component2=function(){return this.positionInBeats},F.prototype.copy_uilc1j$=function(t,e){return new F(void 0===t?this.note:t,void 0===e?this.positionInBeats:e)},F.prototype.toString=function(){return"NotePlacement(note="+e.toString(this.note)+", positionInBeats="+e.toString(this.positionInBeats)+")"},F.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.note)|0,t=31*t+e.hashCode(this.positionInBeats)|0},F.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.note,t.note)&&e.equals(this.positionInBeats,t.positionInBeats)},L.prototype.convertSamplesBufferToNotes_mtnj1d$=function(t){this.minDurationInBeats=listenerApp.parameters.minDurationInBeats;var o=e.kotlin.collections.ArrayList_init_ww73n8$();if(0===t.size)return e.kotlin.collections.emptyList_287e2$();var n=window.performance.now(),i=60/listenerApp.globalTempo,r=t.subList_vux9f0$(0,t.size);pm_log("Converting how many samples: "+e.toString(r.size));var a,s=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(a=r.iterator();a.hasNext();){var l=a.next();s.add_11rb$(l.lengthInSamples)}var c=s.iterator();if(!c.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var p=c.next();c.hasNext();)p=p+c.next()|0;var u=p/this.sampleRate/i;pm_log("Total length of samples in beats: "+u);var h,m=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10));for(h=r.iterator();h.hasNext();){var d=h.next();m.add_11rb$(H().getNoteNumber_14dthe$(d.freq))}var f=wt(r,m);pm_log("After mapping and zipping: "+e.toString(window.performance.now()-n));var g,y=e.kotlin.collections.ArrayList_init_ww73n8$(),_={v:e.kotlin.collections.ArrayList_init_ww73n8$()},v={v:St.MIN_VALUE};for(g=f.iterator();g.hasNext();){var $=g.next();v.v!==$.second&&(y.add_11rb$(_.v),_.v=e.kotlin.collections.ArrayList_init_ww73n8$()),_.v.add_11rb$($),v.v=$.second}y.add_11rb$(_.v),pm_log("After making pairs: "+e.toString(window.performance.now()-n));var b,w=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(f,10));for(b=f.iterator();b.hasNext();){var S=b.next();w.add_11rb$(S.first.lengthInSamples)}var x=w.iterator();if(!x.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var A=x.next();x.hasNext();)A=A+x.next()|0;var k=A/this.sampleRate/i;pm_log("Total length of collected pairs in beats: "+k);var N,T=e.kotlin.collections.ArrayList_init_ww73n8$();for(N=y.iterator();N.hasNext();){var C=N.next();e.kotlin.collections.addAll_ipc267$(T,C)}var P,j=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(T,10));for(P=T.iterator();P.hasNext();){var I=P.next();j.add_11rb$(I.first.lengthInSamples)}var O=j.iterator();if(!O.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var E=O.next();O.hasNext();)E=E+O.next()|0;var z=E/this.sampleRate/i;pm_log("Total length of groups: "+z);var D,L=e.kotlin.collections.ArrayList_init_ww73n8$();for(D=y.iterator();D.hasNext();){var q=D.next();0!==q.size&&L.add_11rb$(q)}var B,M=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(L,10));for(B=L.iterator();B.hasNext();){var R,K,W=B.next(),J=M.add_11rb$,G=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(W,10));for(K=W.iterator();K.hasNext();){var V=K.next();G.add_11rb$(V.first.lengthInSamples)}var X=G.iterator();if(!X.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var Y=X.next();X.hasNext();)Y=Y+X.next()|0;if(Y<i*this.minDurationInBeats*this.sampleRate){var Q,Z=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(W,10));for(Q=W.iterator();Q.hasNext();){var tt=Q.next();Z.add_11rb$(new xt(tt.first,-100))}R=Z}else R=W;J.call(M,R)}var et=M;pm_log("Converted into number groups: "+e.toString(et.size)+" from original: "+e.toString(y.size),0);var ot,nt=e.kotlin.collections.ArrayList_init_ww73n8$();for(ot=et.iterator();ot.hasNext();){var it=ot.next();e.kotlin.collections.addAll_ipc267$(nt,it)}var rt,at=nt,st=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(at,10));for(rt=at.iterator();rt.hasNext();){var lt=rt.next();st.add_11rb$(lt.first.lengthInSamples)}var ct=st.iterator();if(!ct.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var pt=ct.next();ct.hasNext();)pt=pt+ct.next()|0;var ut=pt/this.sampleRate/i;pm_log("Total length of acceptable groups pairs in beats: "+ut),v.v=-1;var ht,mt={v:0},dt={v:0},ft=e.kotlin.collections.ArrayList_init_ww73n8$();for(ht=at.iterator();ht.hasNext();){var gt=ht.next();if(v.v!==gt.second){var yt=new U(v.v,mt.v/(i*this.sampleRate));dt.v=dt.v/mt.v,yt.avgFreq=dt.v,ft.add_11rb$(yt),mt.v=0,dt.v=0}mt.v=mt.v+gt.first.lengthInSamples|0,dt.v+=gt.first.freq*gt.first.lengthInSamples,v.v=gt.second}var _t=new U(v.v,mt.v/(i*this.sampleRate));dt.v=dt.v/mt.v,_t.avgFreq=dt.v,ft.add_11rb$(_t);var vt,$t=e.kotlin.collections.ArrayList_init_ww73n8$();for(vt=ft.iterator();vt.hasNext();){var bt=vt.next();0!==bt.duration&&$t.add_11rb$(bt)}o.addAll_brywnq$($t),pm_log("Notes after combining process: (from original: "+e.toString(at.size),0),pm_log("Turned samples into these notes (before purging): ",0);var At;for(At=ft.iterator();At.hasNext();){var kt=At.next();pm_log("Note: "+e.toString(kt.noteNumber)+" for "+e.toString(kt.duration),0)}var Nt,Tt,Ct=e.kotlin.collections.ArrayList_init_ww73n8$(),Pt=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10)),jt=0;for(Nt=o.iterator();Nt.hasNext();){var It=Nt.next(),Ot=Pt.add_11rb$,Et=(Tt=jt,jt=Tt+1|0,Tt);t:do{if(-100===It.noteNumber){if(0===Et)break t;var zt=o.get_za3lpa$(Et-1|0);zt.duration=zt.duration+It.duration,Ct.add_11rb$(It)}}while(!1);Ot.call(Pt,void 0)}pm_log("Removing "+e.toString(Ct.size),0),o.removeAll_brywnq$(Ct);var Dt,Ft={v:0},Lt=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10));for(Dt=o.iterator();Dt.hasNext();){var qt=Dt.next(),Bt=Lt.add_11rb$,Mt=new F(qt,Ft.v);Ft.v+=qt.duration,Bt.call(Lt,Mt)}var Rt,Kt=e.kotlin.collections.ArrayList_init_ww73n8$();for(Rt=Lt.iterator();Rt.hasNext();){var Ut=Rt.next();-100!==Ut.note.noteNumber&&Kt.add_11rb$(Ut)}var Wt=Kt;pm_log("Turned samples into these notes (after purging): ",0);var Ht;for(Ht=Wt.iterator();Ht.hasNext();){var Jt=Ht.next();pm_log("Note: "+e.toString(Jt.note.noteNumber)+" for "+e.toString(Jt.note.duration)+" at "+e.toString(100*Jt.positionInBeats/100),0)}pm_log("Difference after bogus purge: "+e.toString(ft.size-Wt.size|0),0);var Gt,Vt=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(o,10));for(Gt=o.iterator();Gt.hasNext();){var Xt=Gt.next();Vt.add_11rb$(Xt.duration)}var Yt=Vt.iterator();if(!Yt.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var Qt=Yt.next();Yt.hasNext();)Qt+=Yt.next();var Zt=Qt;pm_log("Length of notes in beats: "+Zt);var te=window.performance.now();return pm_log("Function total time: "+e.toString(te-n)),Wt},L.$metadata$={kind:e.Kind.CLASS,simpleName:"IncrementalBufferManager",interfaces:[]},q.prototype.compareNoteArrays_puujnc$=function(t,o,n,i){void 0===i&&(i=!1);var r,a,s,l,c,p,u,h,m,d,f;this.largestDurationRatioDifference=listenerApp.parameters.largestDurationRatioDifference,this.largestBeatDifference=listenerApp.parameters.largestBeatDifference;var g=new E,y=0,_=-1,v=0;n.size>1&&(v=n.get_za3lpa$(n.size-2|0).positionInBeats);var $=!i;$&&($=n.size>0),$&&(v=At(n).positionInBeats+At(n).note.duration);var b=window.performance.now();a=(r=dt(0,o.size)).first,s=r.last,l=r.step;for(var w=a;w<=s;w+=l){var S,x=o.get_za3lpa$(w),A=-1,N=0,T=gt.MAX_VALUE;p=(c=dt(0,n.size)).first,u=c.last,h=c.step;for(var P=p;P<=u;P+=h){S=n.get_za3lpa$(P).positionInBeats;var z=Math.abs(y-S);z<T&&(A=P,N=S,T=z)}if(y>=v){pm_log("Too far ("+y+" vs "+v+")",0);break}A<=_&&pm_log("Already tested here...... "+A+" <= "+_),_=A,pm_log("Going to compare ideal index "+w+" to test index "+A);var L=e.kotlin.collections.ArrayList_init_ww73n8$(),q=new I(C(),y,L);if(g.feedbackItems.add_11rb$(q),-1!==A){g.attempted=g.attempted+1|0;var B=x,M=n.get_za3lpa$(A);if(pm_log("Durations : "+e.toString(B.duration)+" | "+e.toString(M.note.duration),0),t.testDuration){var R=M.note.duration/B.duration,K=Math.round(100*R)/100;R<listenerApp.parameters.allowableDurationRatio?(pm_log("Test subject too short by "+e.toString(K),0),L.add_11rb$(new k("duration",""+e.toString(K))),O(q)):R>1/listenerApp.parameters.allowableDurationRatio?(pm_log("Test subject too long by "+e.toString(K),0),L.add_11rb$(new k("duration",""+e.toString(Math.abs(K)))),O(q)):pm_log("PERFECT DURATION",0),(R<this.largestDurationRatioDifference||R>1/this.largestDurationRatioDifference)&&(q.type=j())}pm_log("Starting points : "+e.toString(y)+" | "+e.toString(N));var W=-(y-N),J=Math.round(100*W)/100;if(t.testRhythm&&(W>listenerApp.parameters.allowableRhythmMargin?(pm_log("Test subject rushing"),L.add_11rb$(new k("speed","+"+e.toString(J))),O(q)):W<-listenerApp.parameters.allowableRhythmMargin?(pm_log("Test subject dragging"),L.add_11rb$(new k("speed",""+e.toString(J))),O(q)):pm_log("PERFECT"),Math.abs(W)>this.largestBeatDifference&&(q.type=j())),pm_log("Notes : "+e.toString(B.noteNumber)+" | "+e.toString(M.note.noteNumber)),M.note.noteNumber===(B.noteNumber+12|0)||M.note.noteNumber===(B.noteNumber-12|0)){var G=new U(B.noteNumber,M.note.duration);M.note.noteNumber<B.noteNumber?G.avgFreq=null!=(m=M.note.avgFreq)?2*m:null:G.avgFreq=null!=(d=M.note.avgFreq)?d/2:null,M=new F(G,M.positionInBeats)}pm_log("Pitch : "+e.toString(B.getFrequency())+" | "+e.toString(M.note.getFrequency()),0),pm_log("Avg freq of test item: "+e.toString(M.note.avgFreq));var V=M.note.avgFreq;if(null==V&&(q.type=j()),null!=V&&t.testPitch){B.noteNumber!==M.note.noteNumber&&(pm_log("WRONG NOTE *&*&*&*&*&*&*&*"),q.type=j());var X=B.getFrequency(),Y=H().getFrequencyForNoteNumber_za3lpa$(B.noteNumber+1|0),Q=H().getFrequencyForNoteNumber_za3lpa$(B.noteNumber-1|0);if(V-X>0){var Z=Y-X,tt=(V-X)/Z*100;pm_log("Sharp by "+Z+" ("+tt+" cents)"),tt>listenerApp.parameters.allowableCentsMargin&&(pm_log("Test subject sharp"),L.add_11rb$(new k("pitch","+"+e.toString(0|Z))),O(q))}else if(V-B.getFrequency()<0){var et=X-Q,ot=(X-V)/et*100;pm_log("Flat by "+et+" ("+ot+" cents)"),ot>listenerApp.parameters.allowableCentsMargin&&(pm_log("Test subject flat"),L.add_11rb$(new k("pitch","-"+e.toString(0|et))),O(q))}else pm_log("PERFECT")}q.type===C()&&(g.correct=g.correct+1|0);var nt=new D(y+=x.duration,N,B.getFrequency(),null!=(f=M.note.avgFreq)?f:-1,B.duration,M.note.duration);g.finalResults.add_11rb$(nt)}else pm_log("No index found to test",10)}var it=window.performance.now();return pm_log("Function total time: "+e.toString(it-b)),g},q.$metadata$={kind:e.Kind.CLASS,simpleName:"IncrementalComparisonEngine",interfaces:[]},B.prototype.makePostRequest_l6nar7$=function(t,e){networkRequest(t,e)},B.prototype.buildAndSendRequest_fhpv3e$=function(t){var e=t.generateResultForDatabase();e.userID=listenerApp.parameters.userID,e.exerciseID=listenerApp.parameters.exerciseID;var o=new R(e);M().makePostRequest_l6nar7$(listenerApp.parameters.databaseEndpoint,o)},B.$metadata$={kind:e.Kind.OBJECT,simpleName:"ListenerNetworkManager",interfaces:[]};var Ft=null;R.$metadata$={kind:e.Kind.CLASS,simpleName:"PerformanceWrapper",interfaces:[]},R.prototype.component1=function(){return this.performance},R.prototype.copy_w32kyh$=function(t){return new R(void 0===t?this.performance:t)},R.prototype.toString=function(){return"PerformanceWrapper(performance="+e.toString(this.performance)+")"},R.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.performance)|0},R.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.performance,t.performance)},K.$metadata$={kind:e.Kind.CLASS,simpleName:"EasyScoreUtil_Kotlin",interfaces:[]},U.prototype.getFrequency=function(){return H().getFrequencyForNoteNumber_za3lpa$(this.noteNumber)},W.prototype.getNoteNumber_14dthe$=function(t){return-1===t?-1:this.closestNoteToFrequency_14dthe$(t)},W.prototype.getFrequencyForNoteNumber_za3lpa$=function(t){return g().pitch*Math.pow(2,(t-69)/12)},W.prototype.createAllNotes=function(){var t,o,n,i;qt=e.kotlin.collections.ArrayList_init_ww73n8$(),o=(t=dt(30,110)).first,n=t.last,i=t.step;for(var r=o;r<=n;r+=i)qt.add_11rb$(new U(r,1))},W.prototype.closestNoteToFrequency_14dthe$=function(t){var e,o=gt.MAX_VALUE,n=-1;for(e=qt.iterator();e.hasNext();){var i=e.next(),r=Math.abs(i.getFrequency()-t);if(r<o)o=r,n=i.noteNumber;else if(r>o)break}return n},W.$metadata$={kind:e.Kind.OBJECT,simpleName:"Companion",interfaces:[]};var Lt=null;U.$metadata$={kind:e.Kind.CLASS,simpleName:"Note",interfaces:[]};var qt;Object.defineProperty(J.prototype,"state",{get:function(){return this.state_t08vao$_0},set:function(t){this.state_t08vao$_0=t}}),J.prototype.setup=function(){this.audioManager.loadAudioFile_puj7f4$(listenerApp.parameters.url+listenerApp.parameters.audioAssetPath+"Cowbell.wav",this.downbeatAudioKey),this.audioManager.loadAudioFile_puj7f4$(listenerApp.parameters.url+listenerApp.parameters.audioAssetPath+"Woodblock.wav",this.beatAudioKey)},J.prototype.start=function(){this.state=et()},J.prototype.stop=function(){this.state=tt()},J.prototype.step_zgkg49$=function(t,e){var o=6e4/listenerApp.globalTempo;if(e.runForTime-t<o/2)pm_log("Less than beat size..");else{-1===this.lastBeatOccuredAt&&(this.lastBeatOccuredAt=t-o);var n=this.lastBeatOccuredAt+o,i=t/o;this.updateIndicatorUI_14dthe$(i),t>=n&&(g().metronomeAudioOn&&(this.currentBeat%this.timeSignature==0?this.audioManager.playAudioNow_61zpoe$(this.downbeatAudioKey):this.audioManager.playAudioNow_61zpoe$(this.beatAudioKey)),this.lastBeatOccuredAt=n,this.updateMetronomeUI_za3lpa$(this.currentBeat),this.currentBeat=this.currentBeat+1|0)}},J.prototype.cancelAllUIUpdates=function(){var t;for(t=_t(this.timeoutKeys).iterator();t.hasNext();){var e=t.next();pm_log("Cancelling item... "+e),window.clearTimeout(e)}ft(this.timeoutKeys,G)},J.prototype.updateIndicatorUI_14dthe$=function(t){listenerApp.moveToPosition_14dthe$(t-this.prerollBeats)},J.prototype.updateMetronomeUI_za3lpa$=function(t){listenerApp.highlightMetronomeItem_za3lpa$(t%this.timeSignature)},J.prototype.getBeatOfTimestamp_14dthe$=function(t){var e,o,n,i,r,a=-1,s=-1;o=(e=Tt(this.beatTimes)).first,n=e.last,i=e.step;for(var l=o;l<=n;l+=i){var c=this.beatTimes.get_za3lpa$(l);if(c>t){if(-1==(r=l-1|0))return-1;a=this.beatTimes.get_za3lpa$(r),s=c;break}}return-1===a?-1:(t-a)/(s-a)},J.$metadata$={kind:e.Kind.CLASS,simpleName:"Metronome",interfaces:[it]};var Bt;V.$metadata$={kind:e.Kind.CLASS,simpleName:"SampleCollection",interfaces:[]},V.prototype.component1=function(){return this.freq},V.prototype.component2=function(){return this.lengthInSamples},V.prototype.component3=function(){return this.timestampInSamples},V.prototype.copy_mqu1mq$=function(t,e,o){return new V(void 0===t?this.freq:t,void 0===e?this.lengthInSamples:e,void 0===o?this.timestampInSamples:o)},V.prototype.toString=function(){return"SampleCollection(freq="+e.toString(this.freq)+", lengthInSamples="+e.toString(this.lengthInSamples)+", timestampInSamples="+e.toString(this.timestampInSamples)+")"},V.prototype.hashCode=function(){var t=0;return t=31*t+e.hashCode(this.freq)|0,t=31*t+e.hashCode(this.lengthInSamples)|0,t=31*t+e.hashCode(this.timestampInSamples)|0},V.prototype.equals=function(t){return this===t||null!==t&&"object"==typeof t&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&e.equals(this.freq,t.freq)&&e.equals(this.lengthInSamples,t.lengthInSamples)&&e.equals(this.timestampInSamples,t.timestampInSamples)},X.prototype.setup=function(){},X.prototype.start=function(){this.samplesRecorded=0,this.state=et()},X.prototype.stop=function(){this.state=tt()},Object.defineProperty(X.prototype,"state",{get:function(){return this.state_j0gsl6$_0},set:function(t){this.state_j0gsl6$_0=t}}),X.prototype.step_zgkg49$=function(t,o){var n=audioAnalyzer.updatePitch(t);pm_log("Timestamp: "+e.toString(t)),pm_log("Pitch: "+e.toString(n));var i=Bt/2;this.stepWithFrequency_88ee24$(t,n,i,this.latencyTime)},X.prototype.stepWithFrequency_88ee24$=function(t,o,n,i){var r=t-n/this.sampleRate*1e3-i-this.lengthOfPrerollToIgnore;pm_log("Timestamp accounting for preroll "+r);var a=n-this.samplesRecorded+44.1*r;a<0?pm_log("Not filling yet..."):(pm_log("Filling "+e.toString(a)+" with "+o),this.samples.add_11rb$(new V(o,0|a,this.samplesRecorded)),this.samplesRecorded=this.samplesRecorded+(0|a)|0)},X.$metadata$={kind:e.Kind.CLASS,simpleName:"PitchTracker",interfaces:[it]};var Mt,Rt,Kt;Q.$metadata$={kind:e.Kind.CLASS,simpleName:"TimeKeeperState",interfaces:[$t]},Q.values=function(){return[tt(),et(),ot()]},Q.valueOf_61zpoe$=function(t){switch(t){case"Stopped":return tt();case"Running":return et();case"Completed":return ot();default:e.throwISE("No enum constant com.practicingmusician.steppable.TimeKeeper.TimeKeeperState."+t)}},Object.defineProperty(Y.prototype,"state",{get:function(){return this.state_k2u27h$_0},set:function(t){if(t===ot()){pm_log("Completed",10),this.state_k2u27h$_0=tt();var e;for(e=this.finishedActions.iterator();e.hasNext();)e.next()(!0)}else this.state_k2u27h$_0=t}}),Y.prototype.start=function(){this.state=et(),this.requestNextStep()},Y.prototype.stop=function(){this.state=tt(),this.timeOffSet=-1},Y.prototype.requestNextStep=function(){window.requestAnimationFrame(nt(this))},Y.prototype.step_14dthe$=function(t){-1===this.timeOffSet&&(this.timeOffSet=t);var o=t-this.timeOffSet;pm_log("Calling step at : "+e.toString(o)+" (raw: "+t+")");var n;for(n=this.steppables.iterator();n.hasNext();){var i=n.next();i.state===et()&&i.step_zgkg49$(o,this)}var r;for(r=this.analyzers.iterator();r.hasNext();)r.next().analyze_14dthe$(o);o>=this.runForTime&&(pm_log("STOPPED ((((((((((((((((((((((((((((((())))))))))))))))))",9),this.state=ot()),this.state!==tt()&&this.requestNextStep()},Y.prototype.currentTime=function(){return window.performance.now()-this.timeOffSet},Y.$metadata$={kind:e.Kind.CLASS,simpleName:"TimeKeeper",interfaces:[]},it.$metadata$={kind:e.Kind.INTERFACE,simpleName:"TimeKeeperSteppable",interfaces:[]},rt.$metadata$={kind:e.Kind.INTERFACE,simpleName:"TimeKeeperAnalyzer",interfaces:[]},at.prototype.runTest=function(){var t,o=new X;for(t=Pt(new Ct(24,1024),17).iterator();t.hasNext();)t.next();jt("Samples: "+e.toString(o.samples.size))},at.prototype.toggleTest=function(){},at.$metadata$={kind:e.Kind.OBJECT,simpleName:"PitchTrackerTest",interfaces:[]};var Ut=null;st.$metadata$={kind:e.Kind.CLASS,simpleName:"PitchTrackerTestClass",interfaces:[]},Object.defineProperty(lt.prototype,"notationContainerName",{get:function(){return this.notationContainerName_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"metronomeContainerName",{get:function(){return this.metronomeContainerName_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"userID",{get:function(){return this.userID_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"exerciseID",{get:function(){return this.exerciseID_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"databaseEndpoint",{get:function(){return this.databaseEndpoint_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"url",{get:function(){return this.url_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"audioAssetPath",{get:function(){return this.audioAssetPath_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"allowableCentsMargin",{get:function(){return this.allowableCentsMargin_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"allowableRhythmMargin",{get:function(){return this.allowableRhythmMargin_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"allowableDurationRatio",{get:function(){return this.allowableDurationRatio_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"minDurationInBeats",{get:function(){return this.minDurationInBeats_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"largestDurationRatioDifference",{get:function(){return this.largestDurationRatioDifference_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"largestBeatDifference",{get:function(){return this.largestBeatDifference_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"comparisonFlags",{get:function(){return this.comparisonFlags_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"bpm",{get:function(){return this.bpm_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"metronomeSound",{get:function(){return this.metronomeSound_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"pitch",{get:function(){return this.pitch_7mvjxd$_0}}),Object.defineProperty(lt.prototype,"transposition",{get:function(){return this.transposition_7mvjxd$_0}}),lt.$metadata$={kind:e.Kind.CLASS,simpleName:"MockParameters",interfaces:[l]},ct.prototype.testShouldBe_3xie8k$=function(t,o){jt("Results "+e.toString(o.correct)+" / "+e.toString(o.attempted)),t.attempted===o.attempted&&t.correct===o.correct?jt("---- PASSED -----"):(window.alert("Failed"),jt("----- ***** FAILED ****** -----"))},ct.prototype.pitchTrackerTest=function(){var t;jt("***** Pitch tracker test");var o,n=new X,i=ut().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo);for(n.lengthOfPrerollToIgnore=4*this.secondsPerBeat*1e3,jt("Sending preroll"),n.stepWithFrequency_88ee24$(n.lengthOfPrerollToIgnore,1,44.1*n.lengthOfPrerollToIgnore,0),o=n.lengthOfPrerollToIgnore,jt("------"),t=i.iterator();t.hasNext();){var r=t.next();o+=r.lengthInSamples/44100*1e3,jt("sending "+e.toString(r.lengthInSamples)+" at "+o),n.stepWithFrequency_88ee24$(o,r.freq,r.lengthInSamples,0),jt("--------")}var a,s=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(i,10));for(a=i.iterator();a.hasNext();){var l=a.next();s.add_11rb$(l.lengthInSamples)}var c=s.iterator();if(!c.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var p=c.next();c.hasNext();)p=p+c.next()|0;var u,h=p,m=n.samples,d=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(m,10));for(u=m.iterator();u.hasNext();){var f=u.next();d.add_11rb$(f.lengthInSamples)}var g=d.iterator();if(!g.hasNext())throw new e.kotlin.UnsupportedOperationException("Empty collection can't be reduced.");for(var y=g.next();g.hasNext();)y=y+g.next()|0;jt("Sample lengths :  "+h+" | "+y);var _=n.samples,v=(new L).convertSamplesBufferToNotes_mtnj1d$(_),$=ut().addAvgPitchToSamples_j4do5z$(v);jt("Comparing exact copies (incremental)...");var b=new E;b.correct=4,b.attempted=4;var w=new q;this.testShouldBe_3xie8k$(b,w.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,this.notes,$))},ct.prototype.trueIncrementalBufferAndComparisonTest=function(){},ct.prototype.trueIncrementalBufferTest=function(){var t=new L,o=ut().generateExactBufferCollectionWithSize1FromNotes_jisecs$(this.notes,this.tempo);console.log("Starting with "+e.toString(o.size));for(var n=e.kotlin.collections.ArrayList_init_ww73n8$(),i=0;;){var r=i+700|0;r>=o.size&&(r=o.size);var a=o.subList_vux9f0$(i,r);n.addAll_brywnq$(a);var s=t.convertSamplesBufferToNotes_mtnj1d$(n);if(i=i+700|0,r===o.size)break;console.log("Notes after slicing:"),console.log(s)}},ct.prototype.trueIncrementalComparisonTest=function(){var t;jt("****** Beginning true incremental test");var o=new L,n=ut().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),i=o.convertSamplesBufferToNotes_mtnj1d$(n),r=ut().addAvgPitchToSamples_j4do5z$(i);jt("Comparing exact copies (incremental)...");var a=new q;t=r.size;for(var s=0;s<=t;s++){var l=r.subList_vux9f0$(0,s);console.log("Sublist:"+e.toString(l.size)),console.log(l),this.testShouldBe_3xie8k$.call(this,new E(l.size,l.size),a.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,this.notes,l))}},ct.prototype.exactIncrementalTestInBulk=function(){jt("****** Beginning incremental bulk test");var t=new L,e=ut().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),o=t.convertSamplesBufferToNotes_mtnj1d$(e),n=ut().addAvgPitchToSamples_j4do5z$(o);jt("Comparing exact copies (incremental)...");var i=new E;i.correct=4,i.attempted=4;var r=new q;this.testShouldBe_3xie8k$(i,r.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,this.notes,n))},ct.prototype.sharpTest=function(){jt("****** Beginning sharp test");var t=new q,o=new L,n=ut().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),i=o.convertSamplesBufferToNotes_mtnj1d$(n),r=i.get_za3lpa$(1).note.getFrequency(),a=H().getFrequencyForNoteNumber_za3lpa$(i.get_za3lpa$(1).note.noteNumber+1|0),s=a-r,l=s*((listenerApp.parameters.allowableCentsMargin+1|0)/100);jt("Original freq: "+e.toString(r)),jt("Next note up "+a+" distance "+s+" to move "+l),i.get_za3lpa$(3).note.avgFreq=r+l;var c=ut().addAvgPitchToSamples_j4do5z$(i);jt("Comparing sharp copy...");var p=new E;p.correct=3,p.attempted=4,this.testShouldBe_3xie8k$(p,t.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,this.notes,c))},ct.prototype.flatTest=function(){jt("****** Beginning flat test");var t=new q,o=new L,n=ut().generateExactBufferCollectionFromNotes_jisecs$(this.notes,this.tempo),i=o.convertSamplesBufferToNotes_mtnj1d$(n),r=i.get_za3lpa$(1).note.getFrequency(),a=H().getFrequencyForNoteNumber_za3lpa$(i.get_za3lpa$(1).note.noteNumber-1|0),s=r-a,l=s*((listenerApp.parameters.allowableCentsMargin+1|0)/100);jt("Original freq: "+e.toString(r)),jt("Next note up "+a+" distance "+s+" to move "+l),i.get_za3lpa$(3).note.avgFreq=r-l;var c=ut().addAvgPitchToSamples_j4do5z$(i);jt("Comparing flat copy...");var p=new E;p.correct=3,p.attempted=4,this.testShouldBe_3xie8k$(p,t.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,this.notes,c))},ct.prototype.rushedTest=function(){jt("****** Beginning rushed test");var t=new q,e=new L,o=It([new U(69,.5),new U(81,1-listenerApp.parameters.allowableRhythmMargin-.01),new U(69,1),new U(81,1)]),n=ut().generateExactBufferCollectionFromNotes_jisecs$(o,this.tempo),i=e.convertSamplesBufferToNotes_mtnj1d$(n),r=ut().addAvgPitchToSamples_j4do5z$(i),a=new E;a.correct=2,a.attempted=4,jt("Comparing rushed..."),this.testShouldBe_3xie8k$(a,t.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,this.notes,r))},ct.prototype.shortNotesTest=function(){jt("****** Beginning short notes test");var t=new q,e=new L,o=It([new U(69,.31),new U(35,.05),new U(69,.14),new U(81,.78),new U(34,.11),new U(35,.11),new U(69,1),new U(81,1)]),n=ut().generateExactBufferCollectionFromNotes_jisecs$(o,this.tempo),i=e.convertSamplesBufferToNotes_mtnj1d$(n),r=ut().addAvgPitchToSamples_j4do5z$(i),a=new E;a.correct=4,a.attempted=4,jt("Comparing short notes..."),this.testShouldBe_3xie8k$(a,t.compareNoteArrays_puujnc$(listenerApp.parameters.comparisonFlags,this.notes,r))},ct.prototype.runTest=function(){return listenerApp=new o,listenerApp.parameters=new lt,listenerApp.setTempoForTests_14dthe$(this.tempo),H().createAllNotes(),this.exactIncrementalTestInBulk(),this.rushedTest(),this.shortNotesTest(),this.pitchTrackerTest(),this.trueIncrementalComparisonTest(),this.sharpTest(),this.flatTest(),"Done"},ct.$metadata$={kind:e.Kind.OBJECT,simpleName:"SliceTest",interfaces:[]};var Wt=null;pt.prototype.generateExactBufferCollectionWithSize1FromNotes_jisecs$=function(t,o){var n,i=60/o,r=e.kotlin.collections.ArrayList_init_ww73n8$(),a=e.kotlin.collections.ArrayList_init_ww73n8$();for(n=t.iterator();n.hasNext();){var s,l,c,p,u=n.next();a.add_11rb$(r.size);var h=u.duration*i*44100,m=u.getFrequency();l=(s=dt(0,0|h)).first,c=s.last,p=s.step;for(var d=l;d<=c;d+=p)r.add_11rb$(m)}console.log("Note change indexes: "+e.toString(a));var f,g,y=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(r,10)),_=0;for(f=r.iterator();f.hasNext();){var v=f.next(),$=y.add_11rb$,b=new V(v,1,(g=_,_=g+1|0,g));$.call(y,b)}return y},pt.prototype.generateExactBufferCollectionFromNotes_jisecs$=function(t,o){var n,i=60/o,r=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(n=t.iterator();n.hasNext();){var a=n.next(),s=r.add_11rb$,l=new V(a.getFrequency(),a.duration*i*44100|0,-1);s.call(r,l)}return r},pt.prototype.addAvgPitchToSamples_j4do5z$=function(t){var o,n=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(o=t.iterator();o.hasNext();){var i=o.next(),r=n.add_11rb$;null==i.note.avgFreq&&(i.note.avgFreq=i.note.getFrequency()),r.call(n,i)}return n},pt.prototype.addPitchVariationToSamples_d3e2cz$=function(t){var o,n=e.kotlin.collections.ArrayList_init_ww73n8$(e.kotlin.collections.collectionSizeOrDefault_ba2ldo$(t,10));for(o=t.iterator();o.hasNext();){var i=o.next(),r=n.add_11rb$,a=15*Math.random()*2;r.call(n,i+a/2)}return n},pt.prototype.addRhythmVariationToSamples_d3e2cz$=function(t){for(var e=vt(t),o=0;o<=3600;o++)e.removeAt_za3lpa$(0);for(var n=14e3;n<=18e3;n++)e.add_11rb$(e.get_za3lpa$(400));for(var i=13e3;i<=15500;i++)e.removeAt_za3lpa$(0);return e},pt.prototype.addShortItemsThatShouldBeRemoved_d3e2cz$=function(t){for(var e=vt(t),o=0;o<=5;o++)e.add_wxm5ur$(0,2);for(var n=0;n<=15;n++)e.add_wxm5ur$(100,2);for(var i=0;i<=3;i++)e.add_wxm5ur$(1e4,2);return e},pt.$metadata$={kind:e.Kind.OBJECT,simpleName:"TestBufferGenerator",interfaces:[]};var Ht=null,Jt=t.com||(t.com={}),Gt=Jt.practicingmusician||(Jt.practicingmusician={});Gt.ListenerApp=o,Gt.DialogParams=i,Gt.FlashMessage=r,Gt.ComparisonFlags=a,Gt.AppPreferences=s,Gt.AppSetupParameters=l,Gt.AudioAnalyzer=c,Gt.GeneratedExercise=p,Gt.EasyScoreCode=u,Gt.SimpleJSNoteObject=h,Gt.BeatPosition=m,Gt.PMTuner=d,Object.defineProperty(Gt,"UserSettings",{get:g}),(Gt.audio||(Gt.audio={})).AudioManager=y;var Vt=Gt.converter||(Gt.converter={});Vt.GeneratedExerciseInfo=$,Vt.MusicXMLConverter=b;var Xt=Gt.exercises||(Gt.exercises={});Xt.ExerciseDefinition=w,Xt.ExerciseManager=S;var Yt=Gt.finals||(Gt.finals={});Yt.FeedbackMetric=k,Object.defineProperty(N,"Correct",{get:C}),Object.defineProperty(N,"Incorrect",{get:P}),Object.defineProperty(N,"Missed",{get:j}),Yt.FeedbackType=N,Yt.FeedbackItem=I,Yt.throwSafeIncorrectSwitch_a2klfm$=O,Yt.CompareResults=E,Yt.ResultsForDatabase=z,Yt.IndividualNotePerformanceInfo=D,Yt.NotePlacement=F,Yt.IncrementalBufferManager=L,Yt.IncrementalComparisonEngine=q;var Qt=Gt.network||(Gt.network={});Object.defineProperty(Qt,"ListenerNetworkManager",{get:M}),Qt.PerformanceWrapper=R;var Zt=Gt.notes||(Gt.notes={});Zt.EasyScoreUtil_Kotlin=K,Object.defineProperty(U,"Companion",{get:H}),Zt.Note=U,Object.defineProperty(Zt,"ALL_NOTES",{get:function(){return qt},set:function(t){qt=t}});var te=Gt.steppable||(Gt.steppable={});te.Metronome=J,Object.defineProperty(te,"buflen",{get:function(){return Bt},set:function(t){Bt=t}}),te.SampleCollection=V,te.PitchTracker=X,Object.defineProperty(Q,"Stopped",{get:tt}),Object.defineProperty(Q,"Running",{get:et}),Object.defineProperty(Q,"Completed",{get:ot}),Y.TimeKeeperState=Q,te.TimeKeeper=Y,te.TimeKeeperSteppable=it,te.TimeKeeperAnalyzer=rt;var ee=Gt.tests||(Gt.tests={});return Object.defineProperty(ee,"PitchTrackerTest",{get:function(){return null===Ut&&new at,Ut}}),ee.PitchTrackerTestClass=st,ee.MockParameters=lt,Object.defineProperty(ee,"SliceTest",{get:function(){return null===Wt&&new ct,Wt}}),Object.defineProperty(ee,"TestBufferGenerator",{get:ut}),t.main_kand9s$=ht,qt=e.kotlin.collections.ArrayList_init_ww73n8$(),Bt=1024,ht(),e.defineModule("PracticingMusician",t),t}(void 0===PracticingMusician?{}:PracticingMusician,kotlin);